<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –≥–æ–ª–æ—Å–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏ Atlas</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid #444;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.success { background: #2d5a2d; color: #90ee90; }
        .status.error { background: #5a2d2d; color: #ff9090; }
        .status.info { background: #2d2d5a; color: #90b0ff; }
        .status.warning { background: #5a5a2d; color: #ffff90; }
        button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 15px 25px;
            margin: 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover { background: #0088ff; }
        button:disabled { background: #666; cursor: not-allowed; }
        .log {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 10px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #0066cc;
        }
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        input[type="number"] {
            background: #333;
            color: #fff;
            border: 1px solid #555;
            padding: 8px;
            border-radius: 3px;
            width: 80px;
        }
    </style>
</head>
<body>
    <h1>üé§ –¢–µ—Å—Ç –≥–æ–ª–æ—Å–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏ ATLAS</h1>
    
    <div class="test-section">
        <h2>üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º–∏</h2>
        <div id="systemStatus">–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ...</div>
        <button onclick="checkSystemStatus()">–û–Ω–æ–≤–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å</button>
    </div>

    <div class="test-section">
        <h2>üîµ –¢–µ—Å—Ç —Å–∏–Ω—å–æ–≥–æ —Ä–µ–∂–∏–º—É (–≤–∏–∫–ª–∏–∫ Atlas)</h2>
        <div class="controls">
            <button id="blueMode" onclick="toggleBlueMode()">–ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏ —Å–∏–Ω—ñ–π —Ä–µ–∂–∏–º</button>
            <span>–£—Ç—Ä–∏–º–∞–π—Ç–µ –∫–Ω–æ–ø–∫—É –º—ñ–∫—Ä–æ—Ñ–æ–Ω—É 2 —Å–µ–∫—É–Ω–¥–∏, –ø–æ—Ç—ñ–º —Å–∫–∞–∂—ñ—Ç—å "–ê—Ç–ª–∞—Å"</span>
        </div>
        <div id="blueModeStatus" class="status info">–°–∏–Ω—ñ–π —Ä–µ–∂–∏–º –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏–π</div>
        <div class="test-result">
            <strong>–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong>
            <ol>
                <li>–ö–Ω–æ–ø–∫–∞ —Å—Ç–∞—î —Å–∏–Ω—å–æ—é üîµ</li>
                <li>–°–∫–∞–∂—ñ—Ç—å "–ê—Ç–ª–∞—Å" - —Å–∏—Å—Ç–µ–º–∞ –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç—å</li>
                <li>–ü–æ—á–Ω—ñ—Ç—å –≥–æ–≤–æ—Ä–∏—Ç–∏ –∑–∞–≤–¥–∞–Ω–Ω—è</li>
                <li>–ó—É–ø–∏–Ω—ñ—Ç—å—Å—è –Ω–∞ 3 —Å–µ–∫—É–Ω–¥–∏ - —Å–∏—Å—Ç–µ–º–∞ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç—å</li>
            </ol>
        </div>
    </div>

    <div class="test-section">
        <h2>üéß –¢–µ—Å—Ç –ø–æ—Å—Ç-—á–∞—Ç –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞–Ω–Ω—è</h2>
        <div class="controls">
            <button onclick="simulateAtlasResponse()">–°–∏–º—É–ª—é–≤–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å Atlas</button>
            <label>–¢–∏—à–∏–Ω–∞ (–º—Å): <input type="number" id="silenceTime" value="3000" min="1000" max="8000"></label>
        </div>
        <div id="postChatStatus" class="status info">–ü–æ—Å—Ç-—á–∞—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏–π</div>
        <div class="test-result">
            <strong>–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</strong>
            <ol>
                <li>–ü—ñ—Å–ª—è TTS Atlas —Å–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞—î 8-—Å–µ–∫—É–Ω–¥–Ω–µ –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞–Ω–Ω—è</li>
                <li>–ü–æ—á–Ω—ñ—Ç—å –≥–æ–≤–æ—Ä–∏—Ç–∏ - —Å–∏—Å—Ç–µ–º–∞ –≤–∏—è–≤–∏—Ç—å –º–æ–≤–ª–µ–Ω–Ω—è</li>
                <li>–ó—É–ø–∏–Ω—ñ—Ç—å—Å—è –Ω–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π —á–∞—Å - —Å–∏—Å—Ç–µ–º–∞ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç—å</li>
                <li>–§–æ–Ω–æ–≤—ñ —Ñ—Ä–∞–∑–∏ ("–î—è–∫—É—é –∑–∞ –ø–µ—Ä–µ–≥–ª—è–¥") —ñ–≥–Ω–æ—Ä—É—é—Ç—å—Å—è</li>
            </ol>
        </div>
    </div>

    <div class="test-section">
        <h2>üö´ –¢–µ—Å—Ç —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó —Ñ–æ–Ω–æ–≤–∏—Ö —Ñ—Ä–∞–∑</h2>
        <div class="controls">
            <button onclick="testBackgroundPhrases()">–¢–µ—Å—Ç—É–≤–∞—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—é</button>
        </div>
        <div id="filterResults"></div>
    </div>

    <div class="test-section">
        <h2>‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è VAD</h2>
        <div class="controls">
            <label>–ü–æ—Ä—ñ–≥ —Ç–∏—à—ñ (–º—Å): <input type="number" id="vadSilence" value="3000" min="1000" max="8000"></label>
            <label>–ü–æ—Ä—ñ–≥ VAD: <input type="number" id="vadThreshold" value="0.003" min="0.001" max="0.01" step="0.001"></label>
            <label>–í–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å: <input type="number" id="vadConfidence" value="0.25" min="0.1" max="1.0" step="0.05"></label>
            <button onclick="updateVADSettings()">–û–Ω–æ–≤–∏—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</button>
        </div>
        <div id="vadStatus" class="status info">–ü–æ—Ç–æ—á–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è...</div>
    </div>

    <div class="test-section">
        <h2>üìù –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º–∏</h2>
        <div class="controls">
            <button onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç–∏ –ª–æ–≥–∏</button>
            <button onclick="toggleLogLevel()">–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–∏ —Ä—ñ–≤–µ–Ω—å –ª–æ–≥—É–≤–∞–Ω–Ω—è</button>
        </div>
        <div id="logs" class="log">–õ–æ–≥–∏ –∑'—è–≤–ª—è—Ç—å—Å—è —Ç—É—Ç...\n</div>
    </div>

    <script type="module">
        let logLevel = 'info'; // info, debug
        
        // –§—É–Ω–∫—Ü—ñ—è –ª–æ–≥—É–≤–∞–Ω–Ω—è
        function log(message, level = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('logs');
            const colors = {
                'error': '#ff4444',
                'warn': '#ffaa44', 
                'info': '#44ff44',
                'debug': '#4444ff'
            };
            
            if (level === 'debug' && logLevel !== 'debug') return;
            
            const color = colors[level] || '#ffffff';
            logElement.innerHTML += `<span style="color: ${color}">[${timestamp}] [${level.toUpperCase()}] ${message}</span>\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å—É —Å–∏—Å—Ç–µ–º–∏
        window.checkSystemStatus = async function() {
            const statusDiv = document.getElementById('systemStatus');
            statusDiv.innerHTML = '–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ...';
            
            try {
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –æ—Å–Ω–æ–≤–Ω–∏—Ö —Å–µ—Ä–≤—ñ—Å—ñ–≤
                const services = [
                    { name: 'Frontend', url: 'http://localhost:5001/health', port: 5001 },
                    { name: 'Orchestrator', url: 'http://localhost:5101/health', port: 5101 },
                    { name: 'TTS Service', url: 'http://localhost:3001/health', port: 3001 },
                    { name: 'Whisper Service', url: 'http://localhost:3002/health', port: 3002 }
                ];
                
                let statusHTML = '<h3>–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤—ñ—Å—ñ–≤:</h3>';
                
                for (const service of services) {
                    try {
                        const response = await fetch(service.url);
                        const status = response.ok ? '‚úÖ –ü—Ä–∞—Ü—é—î' : '‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞';
                        const color = response.ok ? '#90ee90' : '#ffff90';
                        statusHTML += `<div style="color: ${color}">${service.name} (${service.port}): ${status}</div>`;
                    } catch (error) {
                        statusHTML += `<div style="color: #ff9090">${service.name} (${service.port}): ‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π</div>`;
                    }
                }
                
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ø—ñ–¥—Ç—Ä–∏–º–∫—É Web Speech API
                const speechSupport = 'webkitSpeechRecognition' in window || 'SpeechRecognition' in window;
                const color = speechSupport ? '#90ee90' : '#ff9090';
                const status = speechSupport ? '‚úÖ –ü—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è' : '‚ùå –ù–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è';
                statusHTML += `<div style="color: ${color}">Web Speech API: ${status}</div>`;
                
                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ MediaRecorder
                const mediaSupport = 'MediaRecorder' in window;
                const mediaColor = mediaSupport ? '#90ee90' : '#ff9090';
                const mediaStatus = mediaSupport ? '‚úÖ –ü—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è' : '‚ùå –ù–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è';
                statusHTML += `<div style="color: ${mediaColor}">MediaRecorder API: ${mediaStatus}</div>`;
                
                statusDiv.innerHTML = statusHTML;
                log('–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º–∏ –æ–Ω–æ–≤–ª–µ–Ω–æ', 'info');
                
            } catch (error) {
                statusDiv.innerHTML = `<div style="color: #ff9090">–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏: ${error.message}</div>`;
                log(`–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å—É: ${error.message}`, 'error');
            }
        };
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è —Å–∏–Ω—å–æ–≥–æ —Ä–µ–∂–∏–º—É
        window.toggleBlueMode = function() {
            const button = document.getElementById('blueMode');
            const status = document.getElementById('blueModeStatus');
            
            // –°–∏–º—É–ª—é—î–º–æ –∞–∫—Ç–∏–≤–∞—Ü—ñ—é —Å–∏–Ω—å–æ–≥–æ —Ä–µ–∂–∏–º—É
            if (button.textContent.includes('–ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏')) {
                button.textContent = '–î–µ–∞–∫—Ç–∏–≤—É–≤–∞—Ç–∏ —Å–∏–Ω—ñ–π —Ä–µ–∂–∏–º';
                button.style.background = '#0066ff';
                status.className = 'status success';
                status.textContent = 'üîµ –°–∏–Ω—ñ–π —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–Ω–∏–π - —Å–∫–∞–∂—ñ—Ç—å "–ê—Ç–ª–∞—Å"';
                log('üîµ –°–∏–Ω—ñ–π —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ', 'info');
            } else {
                button.textContent = '–ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏ —Å–∏–Ω—ñ–π —Ä–µ–∂–∏–º';
                button.style.background = '#0066cc';
                status.className = 'status info';
                status.textContent = '–°–∏–Ω—ñ–π —Ä–µ–∂–∏–º –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏–π';
                log('üîµ –°–∏–Ω—ñ–π —Ä–µ–∂–∏–º –¥–µ–∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ', 'info');
            }
        };
        
        // –°–∏–º—É–ª—è—Ü—ñ—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ Atlas
        window.simulateAtlasResponse = function() {
            const status = document.getElementById('postChatStatus');
            status.className = 'status warning';
            status.textContent = 'üéß –ü—Ä–æ–≥—Ä–∞—î—Ç—å—Å—è –≤—ñ–¥–ø–æ–≤—ñ–¥—å Atlas...';
            log('üó£Ô∏è –°–∏–º—É–ª—è—Ü—ñ—è TTS Atlas', 'info');
            
            setTimeout(() => {
                status.className = 'status success';
                status.textContent = 'üéß –ü–æ—Å—Ç-—á–∞—Ç –∞–Ω–∞–ª—ñ–∑ –∞–∫—Ç–∏–≤–Ω–∏–π - –≥–æ–≤–æ—Ä—ñ—Ç—å –ø—Ä–æ—Ç—è–≥–æ–º 8 —Å–µ–∫—É–Ω–¥';
                log('üéß –ü–æ—Å—Ç-—á–∞—Ç –∞–Ω–∞–ª—ñ–∑ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ', 'info');
                
                // –°–∏–º—É–ª—é—î–º–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —á–µ—Ä–µ–∑ 8 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    status.className = 'status info';
                    status.textContent = '–ü–æ—Å—Ç-—á–∞—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ';
                    log('üéß –ü–æ—Å—Ç-—á–∞—Ç –∞–Ω–∞–ª—ñ–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 'info');
                }, 8000);
            }, 3000);
        };
        
        // –¢–µ—Å—Ç —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó —Ñ–æ–Ω–æ–≤–∏—Ö —Ñ—Ä–∞–∑
        window.testBackgroundPhrases = function() {
            const testPhrases = [
                { text: "–î—è–∫—É—é –∑–∞ –ø–µ—Ä–µ–≥–ª—è–¥!", expected: "ignored" },
                { text: "–°—É–±—Ç–∏—Ç—Ä—É–≤–∞–ª—å–Ω–∏—Ü—è –û–ª—è –®–æ—Ä", expected: "ignored" },
                { text: "–°–∫–∞–∂–∏ –º–µ–Ω—ñ —â–æ —Ä–æ–±–∏—Ç–∏", expected: "accepted" },
                { text: "–Ø–∫ —Å–ø—Ä–∞–≤–∏?", expected: "accepted" },
                { text: "–¥—è–∫—É—é", expected: "ignored" },
                { text: "–°—Ç–≤–æ—Ä–∏ –Ω–æ–≤–∏–π —Ñ–∞–π–ª", expected: "accepted" }
            ];
            
            let resultsHTML = '<h3>–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó:</h3>';
            
            testPhrases.forEach(phrase => {
                // –°–∏–º—É–ª—é—î–º–æ –ª–æ–≥—ñ–∫—É —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó
                const isBackground = phrase.text.toLowerCase().includes('–¥—è–∫—É—é') || 
                                   phrase.text.toLowerCase().includes('—Å—É–±—Ç–∏—Ç—Ä—É–≤–∞–ª—å–Ω–∏—Ü—è') ||
                                   phrase.text.length < 10;
                
                const result = isBackground ? 'ignored' : 'accepted';
                const isCorrect = result === phrase.expected;
                const color = isCorrect ? '#90ee90' : '#ff9090';
                const icon = result === 'ignored' ? 'üö´' : '‚úÖ';
                
                resultsHTML += `<div style="color: ${color}">${icon} "${phrase.text}" - ${result} ${isCorrect ? '‚úì' : '‚úó'}</div>`;
            });
            
            document.getElementById('filterResults').innerHTML = resultsHTML;
            log('–¢–µ—Å—Ç —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó —Ñ—Ä–∞–∑ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 'info');
        };
        
        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å VAD
        window.updateVADSettings = function() {
            const silence = document.getElementById('vadSilence').value;
            const threshold = document.getElementById('vadThreshold').value;
            const confidence = document.getElementById('vadConfidence').value;
            
            const status = document.getElementById('vadStatus');
            status.className = 'status success';
            status.innerHTML = `
                <strong>–û–Ω–æ–≤–ª–µ–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:</strong><br>
                –¢–∏—à–∏–Ω–∞: ${silence}–º—Å<br>
                –ü–æ—Ä—ñ–≥ VAD: ${threshold}<br>
                –í–ø–µ–≤–Ω–µ–Ω—ñ—Å—Ç—å: ${confidence}
            `;
            
            log(`‚öôÔ∏è VAD –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω–æ: silence=${silence}–º—Å, threshold=${threshold}, confidence=${confidence}`, 'info');
        };
        
        // –û—á–∏—â–µ–Ω–Ω—è –ª–æ–≥—ñ–≤
        window.clearLogs = function() {
            document.getElementById('logs').innerHTML = '–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω–æ...\n';
        };
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è —Ä—ñ–≤–Ω—è –ª–æ–≥—É–≤–∞–Ω–Ω—è
        window.toggleLogLevel = function() {
            logLevel = logLevel === 'info' ? 'debug' : 'info';
            log(`–†—ñ–≤–µ–Ω—å –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞: ${logLevel}`, 'info');
        };
        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.addEventListener('load', () => {
            checkSystemStatus();
            
            // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ –ø–æ—Ç–æ—á–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
            document.getElementById('vadSilence').value = 3000;
            document.getElementById('vadThreshold').value = 0.003;
            document.getElementById('vadConfidence').value = 0.25;
            updateVADSettings();
            
            log('üé§ –¢–µ—Å—Ç–æ–≤–∞ —Å–∏—Å—Ç–µ–º–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∞', 'info');
            log('–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ä—ñ–∑–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π', 'info');
        });
        
    </script>
</body>
</html>
