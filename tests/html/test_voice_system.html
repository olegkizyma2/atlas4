<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –≥–æ–ª–æ—Å–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏ ATLAS</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid #444;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .status.success { background: #2d5a2d; color: #90ee90; }
        .status.error { background: #5a2d2d; color: #ff9090; }
        .status.info { background: #2d2d5a; color: #90b0ff; }
        button {
            background: #0066cc;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover { background: #0088ff; }
        button:disabled { background: #666; cursor: not-allowed; }
        #micButton {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            font-size: 30px;
            margin: 20px auto;
            display: block;
        }
        .log {
            background: #000;
            color: #0f0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>üé§ –¢–µ—Å—Ç –≥–æ–ª–æ—Å–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏ ATLAS</h1>
    
    <div class="test-section">
        <h2>1. –¢–µ—Å—Ç –≤–∏–∫–ª–∏–∫—É Atlas –∑–∞ –∫–ª—é—á–æ–≤–∏–º —Å–ª–æ–≤–æ–º</h2>
        <div id="keywordStatus" class="status info">–ù–µ –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ</div>
        <button id="micButton" onclick="toggleBlueMode()">üé§</button>
        <p><strong>–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó:</strong></p>
        <ol>
            <li>–£—Ç—Ä–∏–º–∞–π—Ç–µ –∫–Ω–æ–ø–∫—É –º—ñ–∫—Ä–æ—Ñ–æ–Ω—É 2 —Å–µ–∫—É–Ω–¥–∏ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü—ñ—ó —Å–∏–Ω—å–æ–≥–æ —Ä–µ–∂–∏–º—É</li>
            <li>–°–∫–∞–∂—ñ—Ç—å "–ê—Ç–ª–∞—Å" –∫–æ–ª–∏ –∫–Ω–æ–ø–∫–∞ —Å—Ç–∞–Ω–µ —Å–∏–Ω—å–æ—é</li>
            <li>–°–∏—Å—Ç–µ–º–∞ –º–∞—î –≤—ñ–¥–ø–æ–≤—ñ—Å—Ç–∏ —Ç–∞ –ø–æ—á–∞—Ç–∏ –∑–∞–ø–∏—Å</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>2. –¢–µ—Å—Ç –ø–æ—Å—Ç-—á–∞—Ç –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞–Ω–Ω—è</h2>
        <div id="postChatStatus" class="status info">–ù–µ –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ</div>
        <button onclick="simulateAtlasResponse()">–°–∏–º—É–ª—é–≤–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å Atlas</button>
        <p><strong>–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—ó:</strong></p>
        <ol>
            <li>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É "–°–∏–º—É–ª—é–≤–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å Atlas"</li>
            <li>–ü—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è TTS –ø–æ—á–Ω—ñ—Ç—å –≥–æ–≤–æ—Ä–∏—Ç–∏ –ø—Ä–æ—Ç—è–≥–æ–º 8 —Å–µ–∫—É–Ω–¥</li>
            <li>–ó—É–ø–∏–Ω—ñ—Ç—å—Å—è –Ω–∞ 2 —Å–µ–∫—É–Ω–¥–∏ - —Å–∏—Å—Ç–µ–º–∞ –º–∞—î –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</li>
        </ol>
    </div>

    <div class="test-section">
        <h2>3. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h2>
        <div>
            <label>–¢–∏—à–∏–Ω–∞ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è (–º—Å): <input type="number" id="silenceMs" value="3000" min="1000" max="8000"></label><br><br>
            <label>–í—ñ–∫–Ω–æ –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É–≤–∞–Ω–Ω—è (–º—Å): <input type="number" id="windowMs" value="8000" min="3000" max="15000"></label><br><br>
            <label>–ü–æ—Ä—ñ–≥ VAD: <input type="number" id="vadThreshold" value="0.005" min="0.001" max="0.05" step="0.001"></label><br><br>
            <label>–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å –∑–∞–ø–∏—Å—É (–º—Å): <input type="number" id="maxRecordMs" value="15000" min="5000" max="30000"></label><br><br>
            <button onclick="updateConfig()">–û–Ω–æ–≤–∏—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</button>
        </div>
    </div>

    <div class="test-section">
        <h2>4. –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º–∏</h2>
        <button onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç–∏ –ª–æ–≥–∏</button>
        <div id="logs" class="log">–õ–æ–≥–∏ –∑'—è–≤–ª—è—Ç—å—Å—è —Ç—É—Ç...\n</div>
    </div>

    <script type="module">
        import { VOICE_CONFIG } from './web/static/js/voice-control/config.js';
        
        let micManager = null;
        let ttsManager = null;
        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        async function initVoiceSystem() {
            try {
                // –Ü–º–ø–æ—Ä—Ç—É—î–º–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –º–æ–¥—É–ª—ñ
                const { MicrophoneButtonManager } = await import('./web/static/js/voice-control/microphone-manager.js');
                const { TTSManager } = await import('./web/static/js/modules/tts-manager.js');
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ mock chat manager
                const mockChatManager = {
                    sendMessage: (text) => {
                        log(`üì§ –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: "${text}"`, 'success');
                        updatePostChatStatus('success', `–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ: "${text}"`);
                    },
                    ttsManager: null
                };
                
                // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ TTS
                ttsManager = new TTSManager();
                mockChatManager.ttsManager = ttsManager;
                
                // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ –º—ñ–∫—Ä–æ—Ñ–æ–Ω –º–µ–Ω–µ–¥–∂–µ—Ä
                micManager = new MicrophoneButtonManager(mockChatManager);
                
                // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ –∑–≤'—è–∑–æ–∫
                ttsManager.setMicrophoneManager(micManager);
                
                // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑—É—î–º–æ
                await micManager.initialize();
                
                log('‚úÖ –ì–æ–ª–æ—Å–æ–≤–∞ —Å–∏—Å—Ç–µ–º–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞', 'success');
                
            } catch (error) {
                log(`‚ùå –ü–æ–º–∏–ª–∫–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó: ${error.message}`, 'error');
            }
        }
        
        // –õ–æ–≥—É–≤–∞–Ω–Ω—è
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('logs');
            const colorMap = {
                'success': '#90ee90',
                'error': '#ff9090', 
                'info': '#90b0ff'
            };
            
            logElement.innerHTML += `<span style="color: ${colorMap[type] || '#fff'}">[${timestamp}] ${message}</span>\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –∫–ª—é—á–æ–≤–æ–≥–æ —Å–ª–æ–≤–∞
        function updateKeywordStatus(type, message) {
            const element = document.getElementById('keywordStatus');
            element.className = `status ${type}`;
            element.textContent = message;
        }
        
        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—É –ø–æ—Å—Ç-—á–∞—Ç—É
        function updatePostChatStatus(type, message) {
            const element = document.getElementById('postChatStatus');
            element.className = `status ${type}`;
            element.textContent = message;
        }
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è —Å–∏–Ω—å–æ–≥–æ —Ä–µ–∂–∏–º—É
        window.toggleBlueMode = async function() {
            if (!micManager) {
                log('‚ùå –°–∏—Å—Ç–µ–º–∞ –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞', 'error');
                return;
            }
            
            try {
                if (micManager.isKeywordModeActive()) {
                    await micManager.deactivateBlueMode();
                    updateKeywordStatus('info', '–°–∏–Ω—ñ–π —Ä–µ–∂–∏–º –≤–∏–º–∫–Ω–µ–Ω–æ');
                    log('üîµ –°–∏–Ω—ñ–π —Ä–µ–∂–∏–º –≤–∏–º–∫–Ω–µ–Ω–æ', 'info');
                } else {
                    await micManager.activateBlueMode();
                    updateKeywordStatus('success', '–°–∏–Ω—ñ–π —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–Ω–∏–π - —Å–∫–∞–∂—ñ—Ç—å "–ê—Ç–ª–∞—Å"');
                    log('üîµ –°–∏–Ω—ñ–π —Ä–µ–∂–∏–º –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ - —Å–∫–∞–∂—ñ—Ç—å "–ê—Ç–ª–∞—Å"', 'success');
                }
            } catch (error) {
                log(`‚ùå –ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–Ω—è —Ä–µ–∂–∏–º—É: ${error.message}`, 'error');
                updateKeywordStatus('error', `–ü–æ–º–∏–ª–∫–∞: ${error.message}`);
            }
        };
        
        // –°–∏–º—É–ª—è—Ü—ñ—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ Atlas
        window.simulateAtlasResponse = async function() {
            if (!ttsManager) {
                log('‚ùå TTS —Å–∏—Å—Ç–µ–º–∞ –Ω–µ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞', 'error');
                return;
            }
            
            try {
                updatePostChatStatus('info', '–ü—Ä–æ–≥—Ä–∞—î—Ç—å—Å—è –≤—ñ–¥–ø–æ–≤—ñ–¥—å Atlas...');
                log('üó£Ô∏è –ü—Ä–æ–≥—Ä–∞—î—Ç—å—Å—è –≤—ñ–¥–ø–æ–≤—ñ–¥—å Atlas', 'info');
                
                // –°–∏–º—É–ª—é—î–º–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å Atlas
                await ttsManager.speak('–î–æ–±—Ä–µ, —è –∑—Ä–æ–∑—É–º—ñ–≤ –≤–∞—à–µ –∑–∞–≤–¥–∞–Ω–Ω—è. –ó–∞—Ä–∞–∑ –≤–∏–∫–æ–Ω–∞—é.', 'atlas');
                
                log('‚úÖ –í—ñ–¥–ø–æ–≤—ñ–¥—å Atlas –∑–∞–≤–µ—Ä—à–µ–Ω–∞, –æ—á—ñ–∫—É—î—Ç—å—Å—è –ø–æ—Å—Ç-—á–∞—Ç –∞–Ω–∞–ª—ñ–∑', 'success');
                updatePostChatStatus('success', '–ü–æ—Å—Ç-—á–∞—Ç –∞–Ω–∞–ª—ñ–∑ –∞–∫—Ç–∏–≤–Ω–∏–π - –≥–æ–≤–æ—Ä—ñ—Ç—å –ø—Ä–æ—Ç—è–≥–æ–º 8 —Å–µ–∫—É–Ω–¥');
                
            } catch (error) {
                log(`‚ùå –ü–æ–º–∏–ª–∫–∞ TTS: ${error.message}`, 'error');
                updatePostChatStatus('error', `–ü–æ–º–∏–ª–∫–∞ TTS: ${error.message}`);
            }
        };
        
        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
        window.updateConfig = function() {
            const silenceMs = parseInt(document.getElementById('silenceMs').value);
            const windowMs = parseInt(document.getElementById('windowMs').value);
            const vadThreshold = parseFloat(document.getElementById('vadThreshold').value);
            const maxRecordMs = parseInt(document.getElementById('maxRecordMs').value);
            
            VOICE_CONFIG.POST_CHAT.minSilenceMs = silenceMs;
            VOICE_CONFIG.POST_CHAT.windowMs = windowMs;
            VOICE_CONFIG.POST_CHAT.vadThreshold = vadThreshold;
            VOICE_CONFIG.RECORDING_WINDOWS.keywordMaxMs = maxRecordMs;
            VOICE_CONFIG.RECORDING_WINDOWS.shortClickMaxMs = maxRecordMs;
            VOICE_CONFIG.RECORDING_WINDOWS.silenceThresholdMs = silenceMs;
            
            log(`‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω–æ: —Ç–∏—à–∏–Ω–∞=${silenceMs}–º—Å, –≤—ñ–∫–Ω–æ=${windowMs}–º—Å, VAD=${vadThreshold}, –º–∞–∫—Å.–∑–∞–ø–∏—Å=${maxRecordMs}–º—Å`, 'info');
        };
        
        // –û—á–∏—â–µ–Ω–Ω—è –ª–æ–≥—ñ–≤
        window.clearLogs = function() {
            document.getElementById('logs').innerHTML = '–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω–æ...\n';
        };
        
        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.addEventListener('load', initVoiceSystem);
        
        // –°–ª—É—Ö–∞—á—ñ –ø–æ–¥—ñ–π –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —Ä–æ–±–æ—Ç–∏ —Å–∏—Å—Ç–µ–º–∏
        window.addEventListener('atlas-tts-started', (e) => {
            log(`üîä TTS —Ä–æ–∑–ø–æ—á–∞—Ç–æ –¥–ª—è ${e.detail.agent}`, 'info');
        });
        
        window.addEventListener('atlas-tts-completed', (e) => {
            log(`üîá TTS –∑–∞–≤–µ—Ä—à–µ–Ω–æ –¥–ª—è ${e.detail.agent}`, 'info');
        });
    </script>
</body>
</html>
