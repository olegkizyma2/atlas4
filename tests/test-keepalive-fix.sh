#!/bin/bash
# –¢–µ—Å—Ç Keepalive Spam Fix - –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —â–æ –∫–æ–Ω—Å–æ–ª—å –ù–ï —Å–ø–∞–º–∏—Ç—å—Å—è

echo "üß™ Testing Keepalive Console Spam Fix..."
echo "=========================================="
echo ""
echo "üìã Test Steps:"
echo "1. –í—ñ–¥–∫—Ä–∏—Ç–∏ http://localhost:5001 –≤ –±—Ä–∞—É–∑–µ—Ä—ñ"
echo "2. –í—ñ–¥–∫—Ä–∏—Ç–∏ DevTools Console (F12)"
echo "3. –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∑–∞–ø–∏—Ç '–ü—Ä–∏–≤—ñ—Ç'"
echo "4. –î–æ—á–µ–∫–∞—Ç–∏—Å—å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ (–º–æ–∂–µ –∑–∞–π–Ω—è—Ç–∏ ~10-30 —Å–µ–∫—É–Ω–¥)"
echo ""
echo "‚úÖ Expected Results:"
echo "   - –ö–æ–Ω—Å–æ–ª—å –ù–ï –º–∞—î –º—ñ—Å—Ç–∏—Ç–∏ —Ç–∏—Å—è—á—ñ 'Failed to parse stream message'"
echo "   - –ö–æ–Ω—Å–æ–ª—å –ù–ï –º–∞—î –º—ñ—Å—Ç–∏—Ç–∏ 'keepalive' –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è"
echo "   - –¢—ñ–ª—å–∫–∏ –Ω–æ—Ä–º–∞–ª—å–Ω—ñ ATLAS –ª–æ–≥–∏ (CHAT, APP, TTS, ORCHESTRATOR)"
echo "   - DevTools –ø—Ä–∞—Ü—é—é—Ç—å —à–≤–∏–¥–∫–æ, –±–µ–∑ –ª–∞–≥—ñ–≤"
echo ""
echo "‚ùå If Failed:"
echo "   - –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —â–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –≤ api-client.js –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ"
echo "   - –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—å —â–æ –±—Ä–∞—É–∑–µ—Ä cache –æ—á–∏—â–µ–Ω–∏–π (Ctrl+Shift+R)"
echo "   - –ü–æ–¥–∏–≤–∏—Ç–∏—Å—å —á–∏ orchestrator –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î keepalive:"
echo "     tail -20 logs/orchestrator.log | grep keepalive"
echo ""
echo "üîç Backend Check - Recent Orchestrator Logs:"
echo "-------------------------------------------"
tail -30 /Users/dev/Documents/GitHub/atlas4/logs/orchestrator.log | grep -E "(keepalive|stream|chat)" || echo "No relevant logs yet"
echo ""
echo "üìä System Status:"
./restart_system.sh status
echo ""
echo "üöÄ Ready to test! Open http://localhost:5001 and check console."
