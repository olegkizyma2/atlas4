#!/bin/bash
# Test Conversation Loop - Manual Test Instructions
# Created: 2025-10-11 16:50

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘     CONVERSATION LOOP TEST - Manual Test Guide          â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ“‹ Test Steps:"
echo ""
echo "1. Open http://localhost:5001 in browser"
echo ""
echo "2. Open Browser Console (F12 â†’ Console tab)"
echo ""
echo "3. Hold microphone button for 2 seconds â†’ release"
echo "   Expected log: [CONVERSATION_MODE] ğŸ¬ Activating conversation mode..."
echo ""
echo "4. Say 'ĞÑ‚Ğ»Ğ°Ñ' (wait for keyword detection)"
echo "   Expected log: [WHISPER_KEYWORD] ğŸ¯ KEYWORD DETECTED! ĞÑ‚Ğ»Ğ°Ñ."
echo ""
echo "5. Say 'ĞŸÑ€Ğ¸Ğ²Ñ–Ñ‚' (or any phrase)"
echo "   Expected: Transcription â†’ Chat â†’ Atlas responds via TTS"
echo ""
echo "6. âš ï¸ CRITICAL: Wait for TTS to complete, then check logs:"
echo "   Expected log: [APP] ğŸ”Š Emitting TTS_COMPLETED:"
echo "                   isInConversation: true  â† MUST BE TRUE!"
echo "                   conversationManager: true"
echo "                   conversationActive: true"
echo ""
echo "7. âš ï¸ CRITICAL: Check if continuous listening started:"
echo "   Expected log: [CONVERSATION] ğŸ”Š Atlas finished speaking (chat mode) - starting continuous listening"
echo "                 [CONVERSATION] ğŸ”„ Starting continuous listening (no keyword needed)"
echo "                 [MICROPHONE_BUTTON] Starting recording (trigger: conversation_continuous)"
echo ""
echo "8. Say 'Ğ Ğ¾Ğ·ĞºĞ°Ğ¶Ğ¸ Ğ°Ğ½ĞµĞºĞ´Ğ¾Ñ‚' (WITHOUT saying 'ĞÑ‚Ğ»Ğ°Ñ'!)"
echo "   Expected: Recording â†’ Transcription â†’ Chat â†’ Atlas responds â†’ loop continues"
echo ""
echo "9. Wait 5 seconds in silence"
echo "   Expected: Auto-exit to keyword mode"
echo ""
echo "âœ… SUCCESS CRITERIA:"
echo "   - isInConversation: true in TTS_COMPLETED event"
echo "   - Automatic continuous listening after TTS"
echo "   - Recording starts WITHOUT 'ĞÑ‚Ğ»Ğ°Ñ' keyword"
echo "   - Conversation loop cycles automatically"
echo ""
echo "âŒ FAILURE INDICATORS:"
echo "   - isInConversation: false in TTS_COMPLETED"
echo "   - No continuous listening after TTS"
echo "   - Must say 'ĞÑ‚Ğ»Ğ°Ñ' again to record"
echo ""
echo "ğŸ” Debug Commands (paste in browser console):"
echo "   window.app.managers.conversationMode.isConversationActive()"
echo "   // Should return: true (when in conversation mode)"
echo ""
echo "ğŸ“Š Check logs:"
echo "   tail -f logs/orchestrator.log | grep 'TTS_COMPLETED\\|CONVERSATION'"
echo ""
