2025-10-12 00:22:57 [[32MINFO[39M] Axios configured with rate limit handling (429 + Retry-After) {"metadata":{}}
[INIT] Axios configured with 429 rate limit handling
2025-10-12 00:22:57 [[32MINFO[39M] [SYSTEM] startup: [DI] Registering all services... {"metadata":{"category":"system","component":"startup"}}
2025-10-12 00:22:57 [[32MINFO[39M] [SYSTEM] startup: [DI] Registered 8 services {"metadata":{"category":"system","component":"startup","services":["config","logger","errorHandler","telemetry","wsManager","webIntegration","sessions","networkConfig"]}}
2025-10-12 00:22:57 [[32MINFO[39M] [DI] Initializing services... {"metadata":{}}
[DI] Initializing services...
2025-10-12 00:22:57 [[32MINFO[39M] [SYSTEM] startup: [DI] Logger service initialized {"metadata":{"category":"system","component":"startup"}}
[DI] Initialized: logger
2025-10-12 00:22:57 [[32MINFO[39M] [SYSTEM] startup: [DI] Error handler initialized {"metadata":{"category":"system","component":"startup"}}
[DI] Initialized: errorHandler
2025-10-12 00:22:57 [[32MINFO[39M] [SYSTEM] startup: [DI] Telemetry initialized {"metadata":{"category":"system","component":"startup"}}
[DI] Initialized: telemetry
2025-10-12 00:22:57 [[32MINFO[39M] [SYSTEM] startup: [DI] WebSocket manager initialized {"metadata":{"category":"system","component":"startup"}}
[DI] Initialized: wsManager
2025-10-12 00:22:57 [[32MINFO[39M] [SYSTEM] startup: [DI] Web integration initialized {"metadata":{"category":"system","component":"startup"}}
[DI] Initialized: webIntegration
2025-10-12 00:22:57 [[32MINFO[39M] [SYSTEM] startup: [DI] Session store initialized {"metadata":{"category":"system","component":"startup"}}
[DI] Initialized: sessions
2025-10-12 00:22:57 [[32MINFO[39M] [DI] All services initialized {"metadata":{}}
[DI] All services initialized
2025-10-12 00:22:57 [[32MINFO[39M] [SYSTEM] startup: [DI] All services resolved successfully {"metadata":{"category":"system","component":"startup"}}
2025-10-12 00:22:57 [[32MINFO[39M] [SYSTEM] startup: Validating configuration... {"metadata":{"category":"system","component":"startup"}}
2025-10-12 00:22:57 [[32MINFO[39M] [SYSTEM] startup: Configuration validated successfully {"metadata":{"category":"system","component":"startup","agents":5,"stages":13,"services":6}}
2025-10-12 00:22:57 [[32MINFO[39M] [DI] Starting services... {"metadata":{}}
[DI] Starting services...
2025-10-12 00:22:57 [[32MINFO[39M] [SYSTEM] startup: [DI] WebSocket manager ready {"metadata":{"category":"system","component":"startup"}}
[DI] Started: wsManager
2025-10-12 00:22:57 [[32MINFO[39M] [DI] All services started {"metadata":{}}
[DI] All services started
2025-10-12 00:22:57 [[32MINFO[39M] [SYSTEM] startup: Application routes configured {"metadata":{"category":"system","component":"startup"}}
2025-10-12 00:22:57 [[32MINFO[39M] [SYSTEM] startup: Session cleanup timer started {"metadata":{"category":"system","component":"startup"}}
2025-10-12 00:22:57 [[32MINFO[39M] WebSocket server started on port 5102 {"metadata":{"port":5102,"heartbeatInterval":30000}}
2025-10-12 00:22:57 [[32MINFO[39M] [SYSTEM] websocket: WebSocket server running on port 5102 {"metadata":{"category":"system","component":"websocket"}}
(node:46592) [MODULE_TYPELESS_PACKAGE_JSON] Warning: Module type of file:///Users/dev/Documents/GitHub/atlas4/prompts/prompt-registry.js is not specified and it doesn't parse as CommonJS.
Reparsing as ES module because module syntax was detected. This incurs a performance overhead.
To eliminate this warning, add "type": "module" to /Users/dev/Documents/GitHub/atlas4/prompts/package.json.
(Use `node --trace-warnings ...` to show where the warning was created)
2025-10-12 00:22:57 [[32MINFO[39M] [SYSTEM] startup: üöÄ ATLAS Orchestrator v4.0 running on port 5101 {"metadata":{"category":"system","component":"startup"}}
2025-10-12 00:22:57 [[32MINFO[39M] [SYSTEM] features: DI Container, Unified Configuration, Prompt Registry, Web Integration, Real-time Logging, 3D Model Control, TTS Visualization, Centralized State, Unified Error Handling, Agent Manager, Telemetry & Monitoring {"metadata":{"category":"system","component":"features"}}
2025-10-12 00:22:57 [[32MINFO[39M] [SYSTEM] config: Configuration loaded: 5 agents, 13 stages {"metadata":{"category":"system","component":"config"}}
2025-10-12 00:22:57 [[32MINFO[39M] [SYSTEM] startup: ‚úÖ ATLAS Orchestrator fully initialized with DI Container {"metadata":{"category":"system","component":"startup"}}
2025-10-12 00:24:18 [[32MINFO[39M] [WORKFLOW] Stage start - system: Starting workflow for message: "1, 2, 3, 4, 5. 1, 2. 1, 2, 3, 4, 5...." {"metadata":{"category":"workflow","stage":"start","agent":"system","sessionId":"session_1760217858543_btoj116h5","messageLength":35}}
2025-10-12 00:24:18 [[32MINFO[39M] [WORKFLOW] Stage init - system: Starting step-by-step workflow with unified configuration {"metadata":{"category":"workflow","stage":"init","agent":"system","sessionId":"session_1760217858543_btoj116h5"}}
2025-10-12 00:24:18 [[32MINFO[39M] Workflow: Added user message to chatThread (total: 1 messages) {"metadata":{}}
2025-10-12 00:24:18 [[32MINFO[39M] [SYSTEM] debug: Available stage 0 configurations: {"metadata":{"category":"system","component":"debug","sessionId":"session_1760217858543_btoj116h5","count":2,"stages":[{"stage":0,"agent":"system","name":"mode_selection"},{"stage":0,"agent":"atlas","name":"stage0_chat"}]}}
2025-10-12 00:24:18 [[32MINFO[39M] [SYSTEM] debug: Mode stage lookup result: {"metadata":{"category":"system","component":"debug","sessionId":"session_1760217858543_btoj116h5","found":true,"modeStage":{"stage":0,"agent":"system","name":"mode_selection"}}}
2025-10-12 00:24:18 [[32MINFO[39M] Using SystemStageProcessor for stage 0: mode_selection {"metadata":{}}
2025-10-12 00:24:18 [[32MINFO[39M] [SYSTEM] stage: Executing system stage 0: mode_selection {"metadata":{"category":"system","component":"stage"}}
üöÄ [PROMPT-REGISTRY] Starting initialization...
[PROMPTS:prompt-registry] Initializing prompt registry... 
üìÇ [PROMPT-REGISTRY] Loading prompts for agents: [ 'atlas', 'tetyana', 'grisha', 'system', 'voice' ]
üîç [PROMPT-REGISTRY] Checking agent directory: /Users/dev/Documents/GitHub/atlas4/prompts/atlas
üìÑ [PROMPT-REGISTRY] Found 5 JS files for atlas: [
  'stage0_chat.js',
  'stage1_initial_processing.js',
  'stage3_clarification.js',
  'stage6_task_adjustment.js',
  'stage9_retry_cycle.js'
]
[PROMPTS:DEBUG] Loaded prompt: atlas:0:stage0_chat 
[PROMPTS:DEBUG] Loaded prompt: atlas:1:stage1_initial_processing 
[PROMPTS:DEBUG] Loaded prompt: atlas:3:stage3_clarification 
[PROMPTS:DEBUG] Loaded prompt: atlas:6:stage6_task_adjustment 
[PROMPTS:DEBUG] Loaded prompt: atlas:9:stage9_retry_cycle 
üîç [PROMPT-REGISTRY] Checking agent directory: /Users/dev/Documents/GitHub/atlas4/prompts/tetyana
üìÑ [PROMPT-REGISTRY] Found 3 JS files for tetyana: [ 'partial_completion.js', 'stage2_execution.js', 'stage4_retry.js' ]
[PROMPTS:DEBUG] Loaded prompt: tetyana:special:partial_completion 
[PROMPTS:DEBUG] Loaded prompt: tetyana:2:stage2_execution 
[PROMPTS:DEBUG] Loaded prompt: tetyana:4:stage4_retry 
üîç [PROMPT-REGISTRY] Checking agent directory: /Users/dev/Documents/GitHub/atlas4/prompts/grisha
üìÑ [PROMPT-REGISTRY] Found 2 JS files for grisha: [ 'stage5_diagnosis.js', 'stage7_verification.js' ]
[PROMPTS:DEBUG] Loaded prompt: grisha:5:stage5_diagnosis 
[PROMPTS:DEBUG] Loaded prompt: grisha:7:stage7_verification 
üîç [PROMPT-REGISTRY] Checking agent directory: /Users/dev/Documents/GitHub/atlas4/prompts/system
üìÑ [PROMPT-REGISTRY] Found 10 JS files for system: [
  'agent_descriptions.js',
  'chat_summary.js',
  'chat_topic.js',
  'stage-2_post_chat_analysis.js',
  'stage-3_tts_optimization.js',
  'stage0_mode_selection.js',
  'stage8_completion.js',
  'stage_minus1_stop_router.js',
  'tts_optimization.js',
  'workflow_stages.js'
]
[PROMPTS:DEBUG] Loaded prompt: system:special:agent_descriptions 
[PROMPTS:DEBUG] Loaded prompt: system:special:chat_summary 
[PROMPTS:DEBUG] Loaded prompt: system:special:chat_topic 
[PROMPTS:DEBUG] Loaded prompt: system:special:stage-2_post_chat_analysis 
[PROMPTS:DEBUG] Loaded prompt: system:special:stage-3_tts_optimization 
[PROMPTS:DEBUG] Loaded prompt: system:0:stage0_mode_selection 
[PROMPTS:DEBUG] Loaded prompt: system:8:stage8_completion 
[PROMPTS:DEBUG] Loaded prompt: system:-1:stage_minus1_stop_router 
[PROMPTS:DEBUG] Loaded prompt: system:special:tts_optimization 
[PROMPTS:DEBUG] Loaded prompt: system:special:workflow_stages 
üîç [PROMPT-REGISTRY] Checking agent directory: /Users/dev/Documents/GitHub/atlas4/prompts/voice
üìÑ [PROMPT-REGISTRY] Found 2 JS files for voice: [ 'activation_responses.js', 'status_messages.js' ]
[PROMPTS:DEBUG] Loaded prompt: voice:special:activation_responses 
[PROMPTS:DEBUG] Loaded prompt: voice:special:status_messages 
[PROMPT-DEBUG] Looking for: stage=0, agent=system, name=mode_selection
[PROMPT-DEBUG] Trying exact key: system:0:mode_selection
[PROMPT-DEBUG] Looking for: stage=0, agent=atlas, name=chat
[PROMPT-DEBUG] Trying exact key: atlas:0:chat
[PROMPT-DEBUG] Looking for: stage=1, agent=atlas, name=initial_processing
[PROMPT-DEBUG] Trying exact key: atlas:1:initial_processing
[PROMPT-DEBUG] Looking for: stage=2, agent=tetyana, name=execution
[PROMPT-DEBUG] Trying exact key: tetyana:2:execution
[PROMPT-DEBUG] Looking for: stage=3, agent=atlas, name=clarification
[PROMPT-DEBUG] Trying exact key: atlas:3:clarification
[PROMPT-DEBUG] Looking for: stage=4, agent=tetyana, name=retry
[PROMPT-DEBUG] Trying exact key: tetyana:4:retry
[PROMPT-DEBUG] Looking for: stage=5, agent=grisha, name=diagnosis
[PROMPT-DEBUG] Trying exact key: grisha:5:diagnosis
[PROMPT-DEBUG] Looking for: stage=7, agent=grisha, name=verification
[PROMPT-DEBUG] Trying exact key: grisha:7:verification
[PROMPTS:INFO] Prompt registry validation passed 
‚úÖ [PROMPT-REGISTRY] Initialized successfully in 16ms
üìã [PROMPT-REGISTRY] Loaded 22 prompts, cache: 0
[PROMPTS:prompt-registry] Initialized successfully in 16ms { promptsLoaded: 22, cachePrepared: 0 }
[PROMPT-DEBUG] Looking for: stage=0, agent=system, name=mode_selection
[PROMPT-DEBUG] Trying exact key: system:0:mode_selection
2025-10-12 00:24:18 [[32MINFO[39M] [SYSTEM] debug: Mode selection prompts: {"metadata":{"category":"system","component":"debug","sessionId":"session_1760217858543_btoj116h5","systemPromptLength":830,"systemPromptPreview":"You are a binary classifier. Output ONLY JSON.\n\nRULE:\n- task (confidence ‚â• 0.8) = Requires system action via Goose (open app, create file, execute command)\n- chat (confidence ‚â• 0.8) = Atlas can respon","userPromptPreview":"\"1, 2, 3, 4, 5. 1, 2. 1, 2, 3, 4, 5.\""}}
2025-10-12 00:24:18 [[32MINFO[39M] Mode selection: included 1 history messages for context-aware classification {"metadata":{}}
2025-10-12 00:24:18 [[32MINFO[39M] [SYSTEM] debug: Mode selection actual message: {"metadata":{"category":"system","component":"debug","sessionId":"session_1760217858543_btoj116h5","actualMessage":"1, 2, 3, 4, 5. 1, 2. 1, 2, 3, 4, 5.","contextMessageFromPrompt":"\"1, 2, 3, 4, 5. 1, 2. 1, 2, 3, 4, 5.\""}}
2025-10-12 00:24:18 [[32MINFO[39M] [SYSTEM] ai: Calling system API with context for: mode_selection {"metadata":{"category":"system","component":"ai","sessionId":"session_1760217858543_btoj116h5","messageCount":3,"model":"openai/gpt-4o","temperature":0.5}}
2025-10-12 00:24:18 [[32MINFO[39M] [SYSTEM] debug: Mode selection messages: {"metadata":{"category":"system","component":"debug","sessionId":"session_1760217858543_btoj116h5","messages":"[\n  {\n    \"role\": \"system\",\n    \"content\": \"You are a binary classifier. Output ONLY JSON.\\n\\nRULE:\\n- task (confidence ‚â• 0.8) = Requires system action via Goose (open app, create file, execute command)\\n- chat (confidence ‚â• 0.8) = Atlas can respond directly (conversation, explanation, calculation)\\n\\nCRITICAL PATTERNS:\\n‚úÖ task: \\\"Open\\\", \\\"Launch\\\", \\\"Create\\\", \\\"Save\\\", \\\"Run\\\", \\\"Install\\\", \\\"–í—ñ–¥–∫—Ä–∏–π\\\", \\\"–ó–∞–ø—É—Å—Ç–∏\\\", \\\"–°—Ç–≤–æ—Ä–∏\\\"\\n‚úÖ chat: \\\"Tell\\\", \\\"Explain\\\", \\\"What\\\", \\\"How\\\", \\\"Why\\\", \\\"–†..."}}
2025-10-12 00:24:18 [[32MINFO[39M] [SYSTEM] debug: User message for classification: {"metadata":{"category":"system","component":"debug","sessionId":"session_1760217858543_btoj116h5","userMessage":"1, 2, 3, 4, 5. 1, 2. 1, 2, 3, 4, 5."}}
2025-10-12 00:24:20 [[32MINFO[39M] [SYSTEM] ai: System API response received for mode_selection {"metadata":{"category":"system","component":"ai","sessionId":"session_1760217858543_btoj116h5","hasResponse":true,"hasContent":true,"contentLength":35,"content":"{\"mode\": \"chat\", \"confidence\": 0.7}"}}
2025-10-12 00:24:20 [[32MINFO[39M] Mode selection: chat {"metadata":{"sessionId":"session_1760217858543_btoj116h5"}}
2025-10-12 00:24:20 [[32MINFO[39M] Chat route: processing message with 1 messages in thread {"metadata":{}}
2025-10-12 00:24:20 [[32MINFO[39M] Using AgentStageProcessor for stage 0: stage0_chat (agent: atlas) {"metadata":{}}
2025-10-12 00:24:20 [[32MINFO[39M] [AGENT] atlas - start: Starting stage 0: stage0_chat {"metadata":{"category":"agent","agent":"atlas","action":"start"}}
[PROMPT-DEBUG] Looking for: stage=0, agent=atlas, name=stage0_chat
[PROMPT-DEBUG] Trying exact key: atlas:0:stage0_chat
[PROMPT-DEBUG] Found exact match: atlas:0:stage0_chat
2025-10-12 00:24:20 [[32MINFO[39M] Chat mode: included 1 history messages {"metadata":{}}
2025-10-12 00:24:20 [[32MINFO[39M] Using fast API for chat mode with 2 context messages {"metadata":{}}
2025-10-12 00:24:20 [[32MINFO[39M] API call with 2 context messages {"metadata":{"sessionId":"session_1760217858543_btoj116h5","agent":"atlas","stage":0}}
2025-10-12 00:24:21 [[32MINFO[39M] API response received: 98 chars {"metadata":{"sessionId":"session_1760217858543_btoj116h5","contextMessagesUsed":2}}
2025-10-12 00:24:21 [[32MINFO[39M] [AGENT] atlas - complete: Completed stage 0 in 1253ms with 2 context messages {"metadata":{"category":"agent","agent":"atlas","action":"complete"}}
2025-10-12 00:24:21 [[32MINFO[39M] Chat route: response added, thread now has 2 messages {"metadata":{}}
2025-10-12 00:24:21 [[32MINFO[39M] Session history cleanup: 2 ‚Üí 0 messages (mode: chat) {"metadata":{}}
2025-10-12 00:24:21 [[32MINFO[39M] [HTTP] POST /chat/stream 200 (2924ms) {"metadata":{"category":"http","method":"POST","url":"/chat/stream","status":200,"duration":2924,"ip":"::1","userAgent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Ap..."}}
2025-10-12 00:24:57 [[32MINFO[39M] –ú–µ—Ç—Ä–∏–∫–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–æ: /Users/dev/Documents/GitHub/atlas4/logs/metrics/metrics-2025-10-11T21-24-57-509Z.json (2 –∑–∞–ø–∏—Å—ñ–≤) {"metadata":{}}
 start: Starting stage 0: stage0_chat {"metadata":{"category":"agent","agent":"atlas","action":"start"}}
2025-10-12 00:24:20 [INFO] Chat mode: included 1 history messages {"metadata":{}}
2025-10-12 00:24:20 [INFO] Using fast API for chat mode with 2 context messages {"metadata":{}}
2025-10-12 00:24:20 [INFO] API call with 2 context messages {"metadata":{"sessionId":"session_1760217858543_btoj116h5","agent":"atlas","stage":0}}
2025-10-12 00:24:21 [INFO] API response received: 98 chars {"metadata":{"sessionId":"session_1760217858543_btoj116h5","contextMessagesUsed":2}}
2025-10-12 00:24:21 [INFO] [AGENT] atlas - complete: Completed stage 0 in 1253ms with 2 context messages {"metadata":{"category":"agent","agent":"atlas","action":"complete"}}
2025-10-12 00:24:21 [INFO] Chat route: response added, thread now has 2 messages {"metadata":{}}
2025-10-12 00:24:21 [INFO] Session history cleanup: 2 ‚Üí 0 messages (mode: chat) {"metadata":{}}
2025-10-12 00:24:21 [INFO] [HTTP] POST /chat/stream 200 (2924ms) {"metadata":{"category":"http","method":"POST","url":"/chat/stream","status":200,"duration":2924,"ip":"::1","userAgent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) Ap..."}}
2025-10-12 00:24:57 [INFO] –ú–µ—Ç—Ä–∏–∫–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–æ: /Users/dev/Documents/GitHub/atlas4/logs/metrics/metrics-2025-10-11T21-24-57-509Z.json (2 –∑–∞–ø–∏—Å—ñ–≤) {"metadata":{}}
