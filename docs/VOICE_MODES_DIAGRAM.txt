╔═══════════════════════════════════════════════════════════════════════════════╗
║                        ATLAS VOICE MODES - VISUAL SYSTEM                      ║
║                                Version 4.0.0                                   ║
╚═══════════════════════════════════════════════════════════════════════════════╝

┌───────────────────────────────────────────────────────────────────────────────┐
│                            MICROPHONE BUTTON STATES                            │
└───────────────────────────────────────────────────────────────────────────────┘

    🔵 IDLE                 🔴 RECORDING            🟢 CONVERSATION
   ┌─────┐                 ┌─────┐                 ┌─────┐
   │  🔵 │                 │  🔴 │                 │  🟢 │
   │ BLUE│                 │ RED │                 │GREEN│
   └─────┘                 └─────┘                 └─────┘
   Ready                   Recording               Active
   Green border            Blue/Green pulse        Green pulse

    🟡 KEYWORD              🟠 CONTINUOUS
   ┌─────┐                 ┌─────┐
   │  🟡 │                 │  🟠 │
   │YELLO│                 │ORNG │
   └─────┘                 └─────┘
   Waiting "Атлас"         Auto-loop

┌───────────────────────────────────────────────────────────────────────────────┐
│                         MODE 1: QUICK-SEND WORKFLOW                            │
└───────────────────────────────────────────────────────────────────────────────┘

   START                                                                    END
     │                                                                       │
     ▼                                                                       ▼
   ┌────┐    CLICK    ┌────┐   SPEAK   ┌────┐   1.5s    ┌────┐   ATLAS   ┌────┐
   │ 🔵 │ ──────────> │ 🔴 │ ────────> │ 🔴 │ ────────> │ ⚙️  │ ────────> │ 🔵 │
   │IDLE│   1 CLICK   │REC │  TALKING  │REC │  SILENCE  │PROC│  RESPONSE │IDLE│
   └────┘             └────┘           └────┘           └────┘           └────┘
     │                  │                 │                │                 │
     │                  │                 │                │                 │
   Green            Blue pulse        Blue pulse      Processing        Green
   border           (1s interval)     VAD active      Whisper API       border

   Duration: ~5-10 seconds total
   User interaction: 1 click only

┌───────────────────────────────────────────────────────────────────────────────┐
│                      MODE 2: CONVERSATION WORKFLOW                             │
└───────────────────────────────────────────────────────────────────────────────┘

   ACTIVATION PHASE
   ────────────────
   
   ┌────┐  HOLD 2s  ┌────┐   "Атлас"  ┌────┐  ROTATION  ┌────┐
   │ 🔵 │ ────────> │ 🟢 │ ─────────> │ 🟡 │ ────────> │ 🔊 │
   │IDLE│  HOLDING  │CONV│  KEYWORD   │WAIT│ RESPONSE  │TALK│
   └────┘           └────┘   DETECT    └────┘  "слухаю"  └────┘
                     │                   │         │
                 Green pulse         Yellow      TTS
                 (1.5s)             Breathing    Playing

   CONVERSATION LOOP (Continuous)
   ──────────────────────────────

   ┌────┐   AUTO    ┌────┐   SPEAK    ┌────┐   VAD     ┌────┐   ATLAS
   │ 🟠 │ ────────> │ 🔴 │ ────────> │ 🔴 │ ───────> │ ⚙️  │ ──────>
   │AUTO│  RECORD   │REC │  TALKING  │REC │  1.5s    │PROC│  THINKS
   └────┘  (500ms)  └────┘           └────┘  SILENCE  └────┘
     ▲                                                     │
     │                                                     ▼
     │                                                 ┌────┐
     │                                                 │ 🔊 │
     │                                                 │TTS │
     │                                                 └────┘
     │                                                     │
     └─────────────────────────────────────────────────────┘
                    LOOP CONTINUES AUTOMATICALLY!
                    
   EXIT CONDITIONS:
   ────────────────
   1. 5 seconds silence → Return to 🟡 (KEYWORD mode)
   2. Task mode → Complete stop
   3. Manual click → Deactivate

┌───────────────────────────────────────────────────────────────────────────────┐
│                        ACTIVATION RESPONSE ROTATION                            │
└───────────────────────────────────────────────────────────────────────────────┘

   Circular Buffer Algorithm (No Repeats!)
   
   Pool: [20 responses]
   ─────────────────────
   "слухаю"
   "в увазі"
   "готовий до роботи"
   "я уважно Вас слухаю Олег Миколайович"
   "так, Олег Миколайович"
   ... (15 more)
   
   Usage:
   ──────
   1st call  → "слухаю"              Pool: 19 left
   2nd call  → "в увазі"             Pool: 18 left  (NOT "слухаю"!)
   3rd call  → "готовий до роботи"   Pool: 17 left
   ...
   20th call → "готовий працювати, Олег Миколайович"  Pool: 0
   21st call → Pool REFRESH (19 responses, excluding last used)
   
   GUARANTEE: Same response won't repeat until ALL others are used!

┌───────────────────────────────────────────────────────────────────────────────┐
│                           EVENT FLOW DIAGRAM                                   │
└───────────────────────────────────────────────────────────────────────────────┘

   Quick-Send Events:
   ──────────────────
   
   CONVERSATION_MODE_QUICK_SEND_START
            │
            ▼
   AUDIO_READY_FOR_TRANSCRIPTION
            │
            ▼
   WHISPER_TRANSCRIPTION_COMPLETED
            │
            ▼
   SEND_CHAT_MESSAGE
            │
            ▼
   TTS_STARTED → TTS_COMPLETED
   
   Conversation Events:
   ────────────────────
   
   CONVERSATION_MODE_ACTIVATED
            │
            ▼
   START_KEYWORD_DETECTION
            │
            ▼
   KEYWORD_DETECTED { response: "слухаю" }
            │
            ▼
   TTS_SPEAK_REQUEST { isActivationResponse: TRUE }
            │
            ▼
   TTS_COMPLETED { isActivationResponse: TRUE }
            │
            ▼
   CONVERSATION_RECORDING_START
            │
            ▼
   WHISPER_TRANSCRIPTION_COMPLETED
            │
            ▼
   SEND_CHAT_MESSAGE
            │
            ▼
   TTS_COMPLETED { isActivationResponse: FALSE }
            │
            ▼
   ┌─────────────────────────┐
   │ CONTINUOUS_LISTENING    │ ← AUTO-LOOP!
   │ (Orange icon 🟠)        │
   └─────────────────────────┘
            │
            └─────> LOOP back to CONVERSATION_RECORDING_START

┌───────────────────────────────────────────────────────────────────────────────┐
│                            CSS CLASSES REFERENCE                               │
└───────────────────────────────────────────────────────────────────────────────┘

   Mode Classes (Mutually Exclusive):
   ───────────────────────────────────
   .mode-idle           → Green border, no animation
   .mode-quick-send     → Blue gradient, 1s pulse
   .mode-conversation   → Green gradient, 1.5s pulse
   
   State Classes (Can Combine):
   ────────────────────────────
   .recording              → Active recording
   .waiting-response       → Purple pulse
   .continuous-listening   → Cyan pulse
   .atlas-speaking         → Orange pulse
   .pressing              → Scale down effect

┌───────────────────────────────────────────────────────────────────────────────┐
│                         TECHNICAL SPECIFICATIONS                               │
└───────────────────────────────────────────────────────────────────────────────┘

   VAD (Voice Activity Detection):
   ───────────────────────────────
   • Silence Threshold: 0.01 RMS
   • Silence Duration: 1.5 seconds
   • Min Speech Duration: 300ms
   • Analysis: Real-time frame-by-frame
   
   Whisper API:
   ────────────
   • Endpoint: /transcribe
   • Format: WebM Opus, 64kbps
   • Chunk Size (keyword): 2.5 seconds
   • Confidence Threshold: 0.3 (conversation)
   
   Timeouts:
   ─────────
   • Long Press: 2 seconds
   • Quick-Send Max: 30 seconds
   • Conversation Total: 120 seconds
   • User Silence: 5 seconds
   • Continuous Listen Delay: 500ms

┌───────────────────────────────────────────────────────────────────────────────┐
│                              LEGEND                                            │
└───────────────────────────────────────────────────────────────────────────────┘

   Icons:
   ──────
   🔵 Blue   - Idle/Ready
   🔴 Red    - Recording (all modes)
   🟢 Green  - Conversation Active
   🟡 Yellow - Waiting for "Атлас"
   🟠 Orange - Continuous Listening (auto-loop)
   🔊 Speaker- TTS Playing
   ⚙️  Gear   - Processing (Whisper/AI)
   
   States:
   ───────
   IDLE  - Standby, ready for interaction
   REC   - Recording audio
   PROC  - Processing (Whisper API)
   TALK  - TTS playback
   CONV  - Conversation mode active
   WAIT  - Waiting for keyword
   AUTO  - Automatic continuous listening

╔═══════════════════════════════════════════════════════════════════════════════╗
║                           END OF VISUAL DIAGRAM                                ║
║                    For detailed docs see VOICE_MODES_*.md                      ║
╚═══════════════════════════════════════════════════════════════════════════════╝
