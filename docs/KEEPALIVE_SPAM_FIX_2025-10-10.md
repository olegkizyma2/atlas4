# Keepalive Console Spam Fix

**–í–ò–ü–†–ê–í–õ–ï–ù–û:** 10 –∂–æ–≤—Ç–Ω—è 2025 - –ø—ñ–∑–Ω—ñ–π –≤–µ—á—ñ—Ä ~20:15

## üö® –ü—Ä–æ–±–ª–µ–º–∞

**–°–∏–º–ø—Ç–æ–º:**
- –ë—Ä–∞—É–∑–µ—Ä console –≥–µ–Ω–µ—Ä—É–≤–∞–≤ **100,000+ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∑–∞ —Å–µ–∫—É–Ω–¥—É**
- –ö–æ–∂–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è: `Failed to parse stream message {"type":"keepalive","ts":...}`
- –°–∏—Å—Ç–µ–º–∞ –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª–∞ –Ω–∞ –∑–∞–ø–∏—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- DevTools —Å—Ç–∞–≤–∞–ª–∏ –Ω–µ–ø—Ä–∞—Ü–µ–∑–¥–∞—Ç–Ω–∏–º–∏

**–ö–æ—Ä—ñ–Ω—å –ø—Ä–æ–±–ª–µ–º–∏:**
Frontend –ø–∞—Ä—Å–µ—Ä —Å—Ç—Ä—ñ–º—ñ–≤ (`web/static/js/core/api-client.js`) **–Ω–µ –æ–±—Ä–æ–±–ª—è–≤ keepalive** –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:
1. Orchestrator –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î keepalive –∫–æ–∂–Ω—ñ N —Å–µ–∫—É–Ω–¥ (—â–æ–± HTTP connection –Ω–µ –∑–∞–∫—Ä–∏–≤–∞–ª–∞—Å—å)
2. Frontend –ø–∞—Ä—Å–∏—Ç—å JSON, –∞–ª–µ **–ù–ï –º–∞—î –æ–±—Ä–æ–±–Ω–∏–∫–∞** –¥–ª—è —Ç–∏–ø—É `keepalive`
3. –ö–æ–∂–Ω–µ keepalive –≥–µ–Ω–µ—Ä—É—î `logger.warn()` ‚Üí –∫–æ–Ω—Å–æ–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
4. –†–µ–∑—É–ª—å—Ç–∞—Ç: **–º–∞—Å–∏–≤–Ω–∏–π —Å–ø–∞–º** —É –∫–æ–Ω—Å–æ–ª—ñ –±—Ä–∞—É–∑–µ—Ä–∞

## ‚úÖ –†—ñ—à–µ–Ω–Ω—è

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Ñ–∞–π–ª:**
`web/static/js/core/api-client.js`

**–ó–º—ñ–Ω–∏:**
```javascript
// –î–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:
for (const line of lines) {
  try {
    const message = JSON.parse(line);
    if (onMessage) onMessage(message);
  } catch (parseError) {
    this.logger.warn('Failed to parse stream message', line);
  }
}

// –ü—ñ—Å–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:
for (const line of lines) {
  try {
    const message = JSON.parse(line);
    // –¢–∏—Ö–æ —ñ–≥–Ω–æ—Ä—É—î–º–æ keepalive –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
    if (message.type === 'keepalive') continue;
    if (onMessage) onMessage(message);
  } catch {
    // –õ–æ–≥—É—î–º–æ —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —Ü–µ –Ω–µ —Å—Ö–æ–∂–µ –Ω–∞ keepalive
    if (!line.includes('keepalive')) {
      this.logger.warn('Failed to parse stream message', line);
    }
  }
}
```

**–õ–æ–≥—ñ–∫–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
1. **–£—Å–ø—ñ—à–Ω–∏–π –ø–∞—Ä—Å–∏–Ω–≥:** –Ø–∫—â–æ `message.type === 'keepalive'` ‚Üí `continue` (—Ç–∏—Ö–æ –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ)
2. **–ü–æ–º–∏–ª–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥—É:** –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ —Ä—è–¥–æ–∫ –º—ñ—Å—Ç–∏—Ç—å 'keepalive' ‚Üí –ù–ï –ª–æ–≥—É—î–º–æ
3. **–Ü–Ω—à—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:** –û–±—Ä–æ–±–ª—è—é—Ç—å—Å—è —è–∫ –∑–≤–∏—á–∞–π–Ω–æ

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç

**–î–æ:**
- ‚ùå 100,000+ –∫–æ–Ω—Å–æ–ª—å–Ω–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –∑–∞ —Å–µ–∫—É–Ω–¥—É
- ‚ùå DevTools –Ω–µ–ø—Ä–∞—Ü–µ–∑–¥–∞—Ç–Ω—ñ
- ‚ùå –ë—Ä–∞—É–∑–µ—Ä –ª–∞–≥–∞—î
- ‚ùå –ù–µ–º–∞—î –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –Ω–∞ –∑–∞–ø–∏—Ç–∏

**–ü—ñ—Å–ª—è:**
- ‚úÖ Keepalive –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è **—Ç–∏—Ö–æ —ñ–≥–Ω–æ—Ä—É—é—Ç—å—Å—è**
- ‚úÖ –ö–æ–Ω—Å–æ–ª—å —á–∏—Å—Ç–∞, —Ç—ñ–ª—å–∫–∏ —Ä–µ–∞–ª—å–Ω—ñ –ø–æ–º–∏–ª–∫–∏
- ‚úÖ DevTools –ø—Ä–∞—Ü—é—é—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –Ω–∞ –∑–∞–ø–∏—Ç–∏

## üß™ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É
./restart_system.sh restart

# –í—ñ–¥–∫—Ä–∏—Ç–∏ http://localhost:5001
# –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –∑–∞–ø–∏—Ç "–ü—Ä–∏–≤—ñ—Ç"
# –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:
# - –ù–ï –º–∞—î –±—É—Ç–∏ "Failed to parse stream message"
# - –ù–ï –º–∞—î –±—É—Ç–∏ –º–∞—Å–∏–≤–Ω–æ–≥–æ —Å–ø–∞–º—É
# - –¢—ñ–ª—å–∫–∏ –Ω–æ—Ä–º–∞–ª—å–Ω—ñ –ª–æ–≥–∏ ATLAS —Å–∏—Å—Ç–µ–º–∏
```

## üìù –¢–µ—Ö–Ω—ñ—á–Ω—ñ –¥–µ—Ç–∞–ª—ñ

**Keepalive –º–µ—Ö–∞–Ω—ñ–∑–º:**
- Orchestrator –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î: `{"type":"keepalive","ts":1760116154847}\n`
- –Ü–Ω—Ç–µ—Ä–≤–∞–ª: `networkConfig.KEEPALIVE_INTERVAL` (–∑ `config/api-config.js`)
- –ú–µ—Ç–∞: –ó–±–µ—Ä—ñ–≥–∞—Ç–∏ HTTP connection –∞–∫—Ç–∏–≤–Ω–∏–º –ø—ñ–¥ —á–∞—Å –¥–æ–≤–≥–∏—Ö —Å—Ç–∞–¥—ñ–π workflow

**–ß–æ–º—É –≤–∏–Ω–∏–∫–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞:**
- Keepalive –ù–ï –±—É–≤ –∑–∞–¥—É–º–∞–Ω–∏–π –¥–ª—è –æ–±—Ä–æ–±–∫–∏ frontend –ª–æ–≥—ñ–∫–æ—é
- –¶–µ **—Ç–µ—Ö–Ω—ñ—á–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è** –¥–ª—è —É—Ç—Ä–∏–º–∞–Ω–Ω—è –∑'—î–¥–Ω–∞–Ω–Ω—è
- Frontend –º–∞—î —Ç—ñ–ª—å–∫–∏ **—Ç–∏—Ö–æ —ñ–≥–Ω–æ—Ä—É–≤–∞—Ç–∏** –π–æ–≥–æ

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ñ —Ä—ñ—à–µ–Ω–Ω—è (–ù–ï –æ–±—Ä–∞–Ω—ñ):**
1. ‚ùå –ü—Ä–∏–±—Ä–∞—Ç–∏ keepalive –∑ orchestrator ‚Üí —Ä–∏–∑–∏–∫ —Ç–∞–π–º–∞—É—Ç—ñ–≤
2. ‚ùå –î–æ–¥–∞—Ç–∏ –æ–±—Ä–æ–±–Ω–∏–∫ onMessage –¥–ª—è keepalive ‚Üí –∑–∞–π–≤–∏–π –∫–æ–¥
3. ‚úÖ –¢–∏—Ö–æ —Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏ –Ω–∞ —Ä—ñ–≤–Ω—ñ –ø–∞—Ä—Å–µ—Ä–∞ ‚Üí –Ω–∞–π—á–∏—Å—Ç—ñ—à–µ —Ä—ñ—à–µ–Ω–Ω—è

## üîó –ü–æ–≤'—è–∑–∞–Ω—ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

–¶–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è **–ù–ï –ø–æ–≤'—è–∑–∞–Ω–µ** –∑ —ñ–Ω—à–∏–º–∏ —Ñ—ñ–∫—Å–∞–º–∏ –¥–Ω—è:
- TTS/Workflow sync
- Grisha context
- Memory leak
- Token limits

–¶–µ **–æ–∫—Ä–µ–º–∞ –ø—Ä–æ–±–ª–µ–º–∞** –ø–∞—Ä—Å–∏–Ω–≥—É —Å—Ç—Ä—ñ–º—ñ–≤, —è–∫–∞ –≤–∏–Ω–∏–∫–ª–∞ —á–µ—Ä–µ–∑ **–≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –æ–±—Ä–æ–±–∫–∏ keepalive**.

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–ò–ü–†–ê–í–õ–ï–ù–û  
**–í–µ—Ä—Å—ñ—è:** 4.0.0  
**–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç:** CRITICAL (–±–ª–æ–∫—É–≤–∞–ª–æ —Ä–æ–±–æ—Ç—É —Å–∏—Å—Ç–µ–º–∏)
