# Voice Modes Workflow Documentation

**Date:** 2025-10-11  
**Version:** 4.0.0  
**Status:** Refactored & Enhanced

## ğŸ“‹ Overview

Atlas v4.0 Ğ¿Ñ–Ğ´Ñ‚Ñ€Ğ¸Ğ¼ÑƒÑ” Ğ´Ğ²Ğ° Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ¸ Ğ³Ğ¾Ğ»Ğ¾ÑĞ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ²Ğ²Ğ¾Ğ´Ñƒ:
1. **Quick-send** (Ğ¨Ğ²Ğ¸Ğ´ĞºĞ¸Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼) - Ğ¾Ğ´Ğ½Ğµ Ğ½Ğ°Ñ‚Ğ¸ÑĞºĞ°Ğ½Ğ½Ñ
2. **Conversation** (Ğ ĞµĞ¶Ğ¸Ğ¼ Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ¸) - ÑƒÑ‚Ñ€Ğ¸Ğ¼Ğ°Ğ½Ğ½Ñ 2 ÑĞµĞºÑƒĞ½Ğ´Ğ¸

## ğŸ¯ Mode 1: Quick-Send (Ğ¨Ğ²Ğ¸Ğ´ĞºĞ¸Ğ¹ Ğ ĞµĞ¶Ğ¸Ğ¼)

### ĞŸÑ€Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ
Ğ¨Ğ²Ğ¸Ğ´ĞºĞ° Ğ²Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ³Ğ¾Ğ»Ğ¾ÑĞ¾Ğ²Ğ¾Ğ³Ğ¾ Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ½Ñ Ğ² Ñ‡Ğ°Ñ‚ Ğ±ĞµĞ· Ğ°ĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ñ–Ñ— Ğ¿Ğ¾Ğ²Ğ½Ğ¾Ğ³Ğ¾ conversation mode.

### Workflow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Action: ĞšĞ»Ñ–Ğº Ğ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ¼Ñ–ĞºÑ€Ğ¾Ñ„Ğ¾Ğ½Ğ°                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  System: Visual feedback - ÑĞ¸Ğ½Ñ–Ğ¹ pulse (mode-quick-send)        â”‚
â”‚  Status: "Ğ—Ğ°Ğ¿Ğ¸ÑÑƒÑ... (Ğ²Ñ–Ğ´Ğ¿ÑƒÑÑ‚Ñ–Ñ‚ÑŒ Ğ´Ğ»Ñ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ½Ñ)"              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Recording starts:                                               â”‚
â”‚  - MediaRecorder Ğ°ĞºÑ‚Ğ¸Ğ²ÑƒÑ”Ñ‚ÑŒÑÑ                                    â”‚
â”‚  - VAD (Voice Activity Detection) Ğ¼Ğ¾Ğ½Ñ–Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ Ğ°ÑƒĞ´Ñ–Ğ¾ Ñ€Ñ–Ğ²ĞµĞ½ÑŒ      â”‚
â”‚  - Ğ—Ğ°Ñ…Ğ¾Ğ¿Ğ»ĞµĞ½Ğ½Ñ Ğ°ÑƒĞ´Ñ–Ğ¾ Ñ‡Ğ°Ğ½ĞºÑ–Ğ²                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VAD Detection:                                                  â”‚
â”‚  - ĞĞ½Ğ°Ğ»Ñ–Ğ·ÑƒÑ” RMS Ñ€Ñ–Ğ²ĞµĞ½ÑŒ ĞºĞ¾Ğ¶ĞµĞ½ frame                             â”‚
â”‚  - Speech detected: RMS > 0.01                                  â”‚
â”‚  - Silence detected: RMS â‰¤ 0.01 Ğ¿Ñ€Ğ¾Ñ‚ÑĞ³Ğ¾Ğ¼ 1.5 ÑĞµĞº               â”‚
â”‚  - Min speech duration: 300ms                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Auto-stop (VAD silence threshold reached):                     â”‚
â”‚  - MediaRecorder.stop()                                         â”‚
â”‚  - Audio blob ÑÑ‚Ğ²Ğ¾Ñ€ÑÑ”Ñ‚ÑŒÑÑ                                       â”‚
â”‚  - Min duration check: â‰¥ 500ms                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Whisper Transcription:                                          â”‚
â”‚  - POST /transcribe (audio blob)                                â”‚
â”‚  - Response: { text, confidence, ... }                          â”‚
â”‚  - Event: WHISPER_TRANSCRIPTION_COMPLETED                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Transcription Filter:                                           â”‚
â”‚  - Background phrase check (Ñ„Ğ¾Ğ½Ğ¾Ğ²Ñ– Ğ²Ñ–Ğ´ĞµĞ¾)                       â”‚
â”‚  - Confidence threshold check                                   â”‚
â”‚  - Empty/short text filter                                      â”‚
â”‚  - Passed â†’ Send to chat                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Chat Send:                                                      â”‚
â”‚  - Event: SEND_CHAT_MESSAGE                                     â”‚
â”‚  - Payload: { text, source: 'voice', mode: 'quick-send' }     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Atlas Response:                                                 â”‚
â”‚  - OpenAI API processing                                        â”‚
â”‚  - Response text generated                                      â”‚
â”‚  - TTS synthesis (Ukrainian TTS)                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TTS Playback:                                                   â”‚
â”‚  - Audio blob playback                                          â”‚
â”‚  - Visual: Atlas speaking animation                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TTS_COMPLETED:                                                  â”‚
â”‚  - isActivationResponse: false                                  â”‚
â”‚  - mode: 'chat'                                                 â”‚
â”‚  - isInConversation: false                                      â”‚
â”‚  â†’ Return to IDLE (Ğ·ĞµĞ»ĞµĞ½Ğ° ĞºĞ½Ğ¾Ğ¿ĞºĞ°)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Features
- âœ… **VAD Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¸Ğ¹ ÑÑ‚Ğ¾Ğ¿** - Ğ½Ğµ Ñ‚Ñ€ĞµĞ±Ğ° Ğ½Ğ°Ñ‚Ğ¸ÑĞºĞ°Ñ‚Ğ¸ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾
- âœ… **Ğ¨Ğ²Ğ¸Ğ´ĞºÑ–ÑÑ‚ÑŒ** - Ğ¾Ğ´Ğ½Ğµ Ğ½Ğ°Ñ‚Ğ¸ÑĞºĞ°Ğ½Ğ½Ñ, Ğ±ĞµĞ· conversation overhead
- âœ… **Ğ¤Ñ–Ğ»ÑŒÑ‚Ñ€Ğ°Ñ†Ñ–Ñ** - Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğµ Ğ²Ñ–Ğ´ÑÑ–ÑĞ²Ğ°Ğ½Ğ½Ñ Ñ„Ğ¾Ğ½Ğ¾Ğ²Ğ¸Ñ… Ñ„Ñ€Ğ°Ğ·
- âœ… **Visual feedback** - ÑĞ¸Ğ½Ñ–Ğ¹ pulse Ğ¿Ñ–Ğ´ Ñ‡Ğ°Ñ Ğ·Ğ°Ğ¿Ğ¸ÑÑƒ

## ğŸ¯ Mode 2: Conversation (Ğ ĞµĞ¶Ğ¸Ğ¼ Ğ Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ¸)

### ĞŸÑ€Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ
Ğ‘ĞµĞ·Ğ¿ĞµÑ€ĞµÑ€Ğ²Ğ½Ğ¸Ğ¹ Ğ´Ñ–Ğ°Ğ»Ğ¾Ğ³ Ğ· Atlas Ğ±ĞµĞ· Ğ½ĞµĞ¾Ğ±Ñ…Ñ–Ğ´Ğ½Ğ¾ÑÑ‚Ñ– Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞ²Ğ°Ñ‚Ğ¸ "ĞÑ‚Ğ»Ğ°Ñ" Ğ¿Ñ–ÑĞ»Ñ ĞºĞ¾Ğ¶Ğ½Ğ¾Ñ— Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ñ–.

### Workflow
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Action: Ğ£Ñ‚Ñ€Ğ¸Ğ¼Ğ°Ğ½Ğ½Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ 2 ÑĞµĞºÑƒĞ½Ğ´Ğ¸                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Conversation Mode Activated:                                    â”‚
â”‚  - Visual: Ğ—ĞµĞ»ĞµĞ½Ğ¸Ğ¹ pulse (mode-conversation)                   â”‚
â”‚  - Status: "Ğ ĞµĞ¶Ğ¸Ğ¼ Ñ€Ğ¾Ğ·Ğ¼Ğ¾Ğ²Ğ¸ Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ¸Ğ¹"                            â”‚
â”‚  - State: IDLE â†’ CONVERSATION                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Keyword Detection Start:                                        â”‚
â”‚  - Event: START_KEYWORD_DETECTION                               â”‚
â”‚  - Keywords: ['Ğ°Ñ‚Ğ»Ğ°Ñ']                                          â”‚
â”‚  - Service: WhisperKeywordDetection                             â”‚
â”‚  - Status: "Ğ¡ĞºĞ°Ğ¶Ñ–Ñ‚ÑŒ 'ĞÑ‚Ğ»Ğ°Ñ' Ğ´Ğ»Ñ Ğ¿Ğ¾Ñ‡Ğ°Ñ‚ĞºÑƒ..."                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Continuous Keyword Listening:                                   â”‚
â”‚  - Record 2.5 sec audio chunk                                   â”‚
â”‚  - POST /transcribe                                             â”‚
â”‚  - Check if contains "Ğ°Ñ‚Ğ»Ğ°Ñ" (fuzzy match)                     â”‚
â”‚  - NO â†’ Pause 200ms â†’ Record next chunk                        â”‚
â”‚  - YES â†’ Emit KEYWORD_DETECTED                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  KEYWORD_DETECTED Event:                                         â”‚
â”‚  - Keyword: "Ğ°Ñ‚Ğ»Ğ°Ñ"                                             â”‚
â”‚  - Response: getRandomActivationResponse() with ROTATION        â”‚
â”‚    * Circular buffer prevents repeats                           â”‚
â”‚    * Pool refreshes when empty                                  â”‚
â”‚    * Examples: "ÑĞ»ÑƒÑ…Ğ°Ñ", "Ğ² ÑƒĞ²Ğ°Ğ·Ñ–", "Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¸Ğ¹ Ğ´Ğ¾ Ñ€Ğ¾Ğ±Ğ¾Ñ‚Ğ¸"       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Activation Response TTS:                                        â”‚
â”‚  - Event: TTS_SPEAK_REQUEST                                     â”‚
â”‚  - Text: response (e.g., "ÑĞ»ÑƒÑ…Ğ°Ñ")                             â”‚
â”‚  - isActivationResponse: TRUE â† CRITICAL FLAG                   â”‚
â”‚  - mode: 'conversation'                                         â”‚
â”‚  - Ukrainian TTS synthesis                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TTS Playback (Activation):                                      â”‚
â”‚  - Audio playback: "ÑĞ»ÑƒÑ…Ğ°Ñ"                                     â”‚
â”‚  - Visual: Atlas speaking                                       â”‚
â”‚  - Duration: ~1-2 seconds                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TTS_COMPLETED (Activation):                                     â”‚
â”‚  - isActivationResponse: TRUE â† Ğ”ĞµÑ‚ĞµĞºÑ‚ÑƒÑ”Ñ‚ÑŒÑÑ!                  â”‚
â”‚  - Action: Start conversation recording (300ms pause)           â”‚
â”‚  - NOT starting continuous listening yet                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Request Recording:                                         â”‚
â”‚  - Event: CONVERSATION_RECORDING_START                          â”‚
â”‚  - MediaRecorder starts                                         â”‚
â”‚  - VAD monitoring active                                        â”‚
â”‚  - Status: "Ğ—Ğ°Ğ¿Ğ¸ÑÑƒÑ..."                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VAD Detection (User speaks):                                    â”‚
â”‚  - User Ğ³Ğ¾Ğ²Ğ¾Ñ€Ğ¸Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ğ¸Ñ‚                                          â”‚
â”‚  - VAD Ğ´ĞµÑ‚ĞµĞºÑ‚ÑƒÑ” ĞºÑ–Ğ½ĞµÑ†ÑŒ Ñ„Ñ€Ğ°Ğ·Ğ¸ (1.5 ÑĞµĞº Ñ‚Ğ¸ÑˆÑ–)                   â”‚
â”‚  - Auto-stop â†’ Audio blob                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Whisper Transcription:                                          â”‚
â”‚  - POST /transcribe                                             â”‚
â”‚  - Response: { text, confidence }                               â”‚
â”‚  - Event: WHISPER_TRANSCRIPTION_COMPLETED                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Conversation Filter (STRICT):                                   â”‚
â”‚  - Background phrase check                                      â”‚
â”‚  - Short text filter (<5 chars)                                â”‚
â”‚  - Unclear phrases ("Ñ…Ğ¼", "Ğµ", "Ğ°Ğ°")                          â”‚
â”‚  - Low confidence (<0.3)                                        â”‚
â”‚  - FAIL â†’ Return to keyword detection                           â”‚
â”‚  - PASS â†’ Send to chat                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Chat Send:                                                      â”‚
â”‚  - Event: SEND_CHAT_MESSAGE                                     â”‚
â”‚  - Payload: { text, mode: 'conversation', confidence }         â”‚
â”‚  - Add to conversation history                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Atlas Response:                                                 â”‚
â”‚  - OpenAI API processing                                        â”‚
â”‚  - Response generation                                          â”‚
â”‚  - TTS synthesis                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TTS Playback (Atlas Answer):                                    â”‚
â”‚  - Audio playback                                               â”‚
â”‚  - Visual: Atlas speaking                                       â”‚
â”‚  - isActivationResponse: FALSE                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TTS_COMPLETED (Atlas Answer):                                   â”‚
â”‚  - isActivationResponse: FALSE â† CRITICAL!                      â”‚
â”‚  - mode: 'chat'                                                 â”‚
â”‚  - isInConversation: TRUE                                       â”‚
â”‚  â†’ Start CONTINUOUS LISTENING (Ğ‘Ğ•Ğ— "ĞÑ‚Ğ»Ğ°Ñ"!)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Continuous Listening (Auto-loop):                               â”‚
â”‚  - 500ms pause (Ğ¿Ñ€Ğ¸Ñ€Ğ¾Ğ´Ğ½Ñ–ÑÑ‚ÑŒ)                                   â”‚
â”‚  - Auto-start recording Ğ‘Ğ•Ğ— keyword!                            â”‚
â”‚  - VAD monitoring                                               â”‚
â”‚  - Status: "Ğ¡Ğ»ÑƒÑ…Ğ°Ñ... (Ğ³Ğ¾Ğ²Ğ¾Ñ€Ñ–Ñ‚ÑŒ Ğ°Ğ±Ğ¾ 5 ÑĞµĞº Ñ‚Ğ¸ÑˆÑ–)"             â”‚
â”‚  - Silence timer: 5 seconds                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
             â”‚               â”‚
             â–¼               â–¼
     User Speaks     5 Sec Silence
             â”‚               â”‚
             â”‚               â–¼
             â”‚    Return to Keyword Detection
             â”‚    ("Ğ¡ĞºĞ°Ğ¶Ñ–Ñ‚ÑŒ 'ĞÑ‚Ğ»Ğ°Ñ'...")
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LOOP CONTINUES:                                                 â”‚
â”‚  - VAD detects end â†’ Whisper â†’ Filter â†’ Chat â†’ Atlas TTS       â”‚
â”‚  â†’ TTS_COMPLETED â†’ Continuous listening â†’ REPEAT                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Exit Conditions

#### 1. User Silence (5 seconds)
```
Continuous Listening â†’ 5 sec silence â†’ Return to Keyword Detection
â†’ User must say "ĞÑ‚Ğ»Ğ°Ñ" again to continue
```

#### 2. Task Mode Detected
```
Chat Response mode: 'task' â†’ NO continuous listening
â†’ Task execution workflow instead
â†’ Conversation loop STOPS
```

#### 3. Manual Exit
```
User clicks button during conversation â†’ Deactivate conversation mode
â†’ Return to IDLE
```

### Key Features
- âœ… **Activation Response Rotation** - Ñ€Ñ–Ğ·Ğ½Ğ¾Ğ¼Ğ°Ğ½Ñ–Ñ‚Ğ½Ñ–ÑÑ‚ÑŒ Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´ĞµĞ¹, Ğ‘Ğ•Ğ— Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ñ–Ğ²
- âœ… **Auto-loop after TTS** - Ğ½Ğµ Ñ‚Ñ€ĞµĞ±Ğ° Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑĞ²Ğ°Ñ‚Ğ¸ "ĞÑ‚Ğ»Ğ°Ñ"
- âœ… **VAD integration** - Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡Ğ½Ğ¸Ğ¹ ÑÑ‚Ğ¾Ğ¿ Ğ¿Ñ€Ğ¸ Ñ‚Ğ¸ÑˆÑ–
- âœ… **Intelligent filtering** - Ğ²Ñ–Ğ´ÑÑ–ÑĞ²Ğ°Ğ½Ğ½Ñ Ñ„Ğ¾Ğ½Ğ¾Ğ²Ğ¸Ñ… Ñ– Ğ½ĞµĞ²Ğ¸Ñ€Ğ°Ğ·Ğ½Ğ¸Ñ… Ñ„Ñ€Ğ°Ğ·
- âœ… **Conversation history** - ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚ Ğ·Ğ±ĞµÑ€Ñ–Ğ³Ğ°Ñ”Ñ‚ÑŒÑÑ Ğ¿Ñ€Ğ¾Ñ‚ÑĞ³Ğ¾Ğ¼ Ğ´Ñ–Ğ°Ğ»Ğ¾Ğ³Ñƒ
- âœ… **Visual feedback** - Ğ·ĞµĞ»ĞµĞ½Ğ¸Ğ¹ pulse Ğ¿Ñ–Ğ´ Ñ‡Ğ°Ñ conversation mode

## ğŸ”§ Technical Components

### 1. ConversationModeManager
- **Location:** `web/static/js/voice-control/conversation-mode-manager.js`
- **Role:** Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»Ñ–Ğ½Ğ½Ñ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°Ğ¼Ğ¸, ĞºĞ¾Ğ¾Ñ€Ğ´Ğ¸Ğ½Ğ°Ñ†Ñ–Ñ workflow
- **Key Methods:**
  - `activateQuickSendMode()` - Mode 1 activation
  - `activateConversationMode()` - Mode 2 activation
  - `onKeywordActivation()` - ĞĞ±Ñ€Ğ¾Ğ±ĞºĞ° "ĞÑ‚Ğ»Ğ°Ñ" + activation response
  - `handleTTSCompleted()` - Ğ Ğ¾Ğ·Ğ¿Ñ–Ğ·Ğ½Ğ°Ğ²Ğ°Ğ½Ğ½Ñ Ñ‚Ğ¸Ğ¿Ñƒ TTS (activation vs chat)
  - `startContinuousListening()` - Auto-loop Ğ¿Ñ–ÑĞ»Ñ Atlas Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ñ–

### 2. WhisperKeywordDetection
- **Location:** `web/static/js/voice-control/services/whisper-keyword-detection.js`
- **Role:** Continuous listening Ğ´Ğ»Ñ "ĞÑ‚Ğ»Ğ°Ñ"
- **Key Features:**
  - 2.5 sec audio chunks
  - Whisper API transcription
  - Fuzzy keyword matching
  - **Activation response rotation** (NEW!)

### 3. MicrophoneButtonService
- **Location:** `web/static/js/voice-control/services/microphone-button-service.js`
- **Role:** Ğ—Ğ°Ğ¿Ğ¸Ñ Ğ°ÑƒĞ´Ñ–Ğ¾, VAD integration
- **Key Methods:**
  - `handleQuickSendModeStart()` - Quick-send recording
  - `handleConversationRecordingStart()` - Conversation recording
  - `startRecording()` - Universal recording with VAD

### 4. SimpleVAD
- **Location:** `web/static/js/voice-control/services/microphone/simple-vad.js`
- **Role:** Voice Activity Detection
- **Config:**
  - `silenceThreshold: 0.01` (RMS)
  - `silenceDuration: 1500ms`
  - `minSpeechDuration: 300ms`

### 5. ConversationUIController
- **Location:** `web/static/js/voice-control/conversation/ui-controller.js`
- **Role:** Ğ’Ñ–Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ– Ñ–Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ğ¸
- **CSS Classes:**
  - `.mode-idle` - Standby (Ğ·ĞµĞ»ĞµĞ½Ğ¸Ğ¹ border)
  - `.mode-quick-send` - Ğ¡Ğ¸Ğ½Ñ–Ğ¹ pulse
  - `.mode-conversation` - Ğ—ĞµĞ»ĞµĞ½Ğ¸Ğ¹ pulse

## ğŸ“Š Event Flow

### Quick-Send Events
```
CONVERSATION_MODE_QUICK_SEND_START
  â†’ AUDIO_READY_FOR_TRANSCRIPTION
    â†’ WHISPER_TRANSCRIPTION_COMPLETED
      â†’ SEND_CHAT_MESSAGE
        â†’ (Atlas processing)
          â†’ TTS_STARTED
            â†’ TTS_COMPLETED (isActivationResponse: false)
```

### Conversation Mode Events
```
CONVERSATION_MODE_ACTIVATED
  â†’ START_KEYWORD_DETECTION
    â†’ KEYWORD_DETECTED (response: "ÑĞ»ÑƒÑ…Ğ°Ñ")
      â†’ TTS_SPEAK_REQUEST (isActivationResponse: TRUE)
        â†’ TTS_STARTED
          â†’ TTS_COMPLETED (isActivationResponse: TRUE)
            â†’ CONVERSATION_RECORDING_START
              â†’ WHISPER_TRANSCRIPTION_COMPLETED
                â†’ SEND_CHAT_MESSAGE
                  â†’ TTS_STARTED
                    â†’ TTS_COMPLETED (isActivationResponse: FALSE)
                      â†’ Continuous Listening â†’ LOOP
```

## ğŸ¨ Visual Feedback States

| State | CSS Class | Animation | Button Color |
|-------|-----------|-----------|--------------|
| Idle | `.mode-idle` | None | Green border |
| Quick-send recording | `.mode-quick-send .recording` | Blue pulse | Blue gradient |
| Conversation active | `.mode-conversation` | Green pulse | Green gradient |
| Waiting for keyword | `.mode-conversation` | Breathing | Green pulse |
| Atlas speaking | `.atlas-speaking` | Orange pulse | Orange gradient |
| Continuous listening | `.continuous-listening` | Blue-green pulse | Cyan gradient |

## ğŸ”’ Critical Flags

### isActivationResponse
**Purpose:** Ğ Ğ¾Ğ·Ñ€Ñ–Ğ·Ğ½ÑÑ” activation TTS vs chat response TTS

```javascript
// Activation response (Ğ¿Ñ–ÑĞ»Ñ "ĞÑ‚Ğ»Ğ°Ñ")
{
  isActivationResponse: true,
  text: "ÑĞ»ÑƒÑ…Ğ°Ñ",
  mode: "conversation"
}
// â†’ After TTS: Start recording

// Chat response
{
  isActivationResponse: false,
  text: "Ğ¯ Ğ¼Ğ¾Ğ¶Ñƒ Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–ÑÑ‚Ğ¸ Ğ½Ğ° Ğ²Ğ°ÑˆĞµ Ğ·Ğ°Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ½Ñ...",
  mode: "chat"
}
// â†’ After TTS: Start continuous listening
```

### mode ('chat' vs 'task')
**Purpose:** Ğ’Ğ¸Ğ·Ğ½Ğ°Ñ‡Ğ°Ñ” Ñ‡Ğ¸ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ²Ğ¶ÑƒĞ²Ğ°Ñ‚Ğ¸ conversation loop

```javascript
// Chat mode - conversation loop Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ²Ğ¶ÑƒÑ”Ñ‚ÑŒÑÑ
{ mode: 'chat', isInConversation: true }
â†’ TTS_COMPLETED â†’ Continuous listening

// Task mode - conversation loop Ğ—Ğ£ĞŸĞ˜ĞĞ¯Ğ„Ğ¢Ğ¬Ğ¡Ğ¯
{ mode: 'task', isInConversation: true }
â†’ TTS_COMPLETED â†’ NO continuous listening (task execution)
```

## ğŸ“ Known Issues & Solutions

### Issue: Activation response Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€ÑÑ”Ñ‚ÑŒÑÑ
**Solution:** âœ… FIXED - Rotation system Ğ· circular buffer

### Issue: Conversation loop Ğ½Ğµ Ğ¿Ñ€Ğ¾Ğ´Ğ¾Ğ²Ğ¶ÑƒÑ”Ñ‚ÑŒÑÑ Ğ¿Ñ–ÑĞ»Ñ TTS
**Solution:** âœ… FIXED - isActivationResponse flag + proper event routing

### Issue: ĞšĞ½Ğ¾Ğ¿ĞºĞ° Ğ½Ğµ Ğ¿Ğ¾ĞºĞ°Ğ·ÑƒÑ” Ñ€ĞµĞ¶Ğ¸Ğ¼
**Solution:** âœ… FIXED - CSS mode classes + UI controller updates

### Issue: VAD Ğ½Ğµ Ğ´ĞµÑ‚ĞµĞºÑ‚ÑƒÑ” ĞºÑ–Ğ½ĞµÑ†ÑŒ Ñ„Ñ€Ğ°Ğ·Ğ¸
**Solution:** âœ… Working - SimpleVAD Ğ· 1.5 sec silence threshold

## ğŸš€ Future Improvements

- [ ] Adaptive VAD thresholds (based on environment noise)
- [ ] Multi-language activation keywords
- [ ] Voice biometrics for user identification
- [ ] Context-aware activation responses
- [ ] Gesture-based mode switching
- [ ] Offline mode with Web Speech API fallback

---

**Last Updated:** 2025-10-11  
**Maintainer:** Atlas Development Team  
**Version:** 4.0.0
