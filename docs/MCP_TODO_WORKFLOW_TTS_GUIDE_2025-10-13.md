# MCP Dynamic TODO Workflow - TTS Ğ¾Ğ·Ğ²ÑƒÑ‡ĞµĞ½Ğ½Ñ Ñ‚Ğ° Ğ²Ğ¸Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ (13.10.2025 ~23:30)

## ğŸ¯ ĞĞ³Ğ»ÑĞ´ workflow

MCP Dynamic TODO Workflow - Ñ†Ğµ **item-by-item execution** ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°, Ğ´Ğµ:
- **Atlas** ÑÑ‚Ğ²Ğ¾Ñ€ÑÑ” TODO ÑĞ¿Ğ¸ÑĞ¾Ğº (1-3 Ğ°Ğ±Ğ¾ 4-10 Ğ¿ÑƒĞ½ĞºÑ‚Ñ–Ğ²)
- **Ğ¢ĞµÑ‚ÑĞ½Ğ°** Ğ¿Ğ»Ğ°Ğ½ÑƒÑ” tools Ñ– Ğ²Ğ¸ĞºĞ¾Ğ½ÑƒÑ” ĞšĞĞ–Ğ•Ğ Ğ¿ÑƒĞ½ĞºÑ‚ Ğ¾ĞºÑ€ĞµĞ¼Ğ¾
- **Ğ“Ñ€Ñ–ÑˆĞ°** Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€ÑÑ” ĞšĞĞ–Ğ•Ğ Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ¸Ğ¹ Ğ¿ÑƒĞ½ĞºÑ‚
- **Atlas** ĞºĞ¾Ñ€Ğ¸Ğ³ÑƒÑ” TODO Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ°Ñ… (Ğ´Ğ¾ 3 ÑĞ¿Ñ€Ğ¾Ğ±)

---

## ğŸ”„ Workflow ÑÑ…ĞµĞ¼Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stage 0.5: Backend Selection (System)                       â”‚
â”‚ Ğ’Ğ¸Ğ·Ğ½Ğ°Ñ‡Ğ°Ñ”: mcp vs goose                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stage 1-MCP: Atlas TODO Planning                            â”‚
â”‚ - ĞĞ½Ğ°Ğ»Ñ–Ğ·ÑƒÑ” Ğ·Ğ°Ğ¿Ğ¸Ñ‚                                            â”‚
â”‚ - Ğ¡Ñ‚Ğ²Ğ¾Ñ€ÑÑ” TODO (standard 1-3 / extended 4-10)              â”‚
â”‚ - Ğ’Ğ¸Ğ·Ğ½Ğ°Ñ‡Ğ°Ñ” complexity (1-10)                                â”‚
â”‚ ğŸ”Š TTS: "ĞŸĞ»Ğ°Ğ½ Ğ· X Ğ¿ÑƒĞ½ĞºÑ‚Ñ–Ğ², Ğ¿Ğ¾Ñ‡Ğ¸Ğ½Ğ°Ñ Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ½Ñ" (2.5s)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Ğ¦Ğ˜ĞšĞ› Ğ”Ğ›Ğ¯ ĞšĞĞ–ĞĞĞ“Ğ TODO ITEM         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stage 2.1-MCP: Ğ¢ĞµÑ‚ÑĞ½Ğ° Plan Tools                            â”‚
â”‚ - ĞĞ½Ğ°Ğ»Ñ–Ğ·ÑƒÑ” item action                                      â”‚
â”‚ - ĞŸÑ–Ğ´Ğ±Ğ¸Ñ€Ğ°Ñ” MCP tools (filesystem/playwright/etc)           â”‚
â”‚ - Ğ“Ğ¾Ñ‚ÑƒÑ” parameters Ğ´Ğ»Ñ Ğ²Ğ¸ĞºĞ»Ğ¸ĞºÑƒ                              â”‚
â”‚ ğŸ”Š TTS: "Ğ’Ñ–Ğ´ĞºÑ€Ğ¸Ğ²Ğ°Ñ..." / "Ğ¡Ñ‚Ğ²Ğ¾Ñ€ÑÑ..." (150ms)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stage 2.2-MCP: Ğ¢ĞµÑ‚ÑĞ½Ğ° Execute Tools                         â”‚
â”‚ - Ğ’Ğ¸ĞºĞ»Ğ¸ĞºĞ°Ñ” MCP tools Ñ‡ĞµÑ€ĞµĞ· MCP Manager                      â”‚
â”‚ - Ğ—Ğ±Ğ¸Ñ€Ğ°Ñ” Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¸ Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ½Ñ                               â”‚
â”‚ ğŸ”Š TTS: "Ğ¡Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾" / "Ğ’Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ğ¾" / "Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾" (100-800ms)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stage 2.3-MCP: Ğ“Ñ€Ñ–ÑˆĞ° Verify Item                            â”‚
â”‚ - ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ÑÑ” Ğ¢Ğ†Ğ›Ğ¬ĞšĞ˜ Ğ¿Ğ¾Ñ‚Ğ¾Ñ‡Ğ½Ğ¸Ğ¹ item                            â”‚
â”‚ - Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒÑ” success_criteria Ğ· TODO                      â”‚
â”‚ - Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒÑ” tools Ğ´Ğ»Ñ Ñ„Ğ°ĞºÑ‚Ğ¸Ñ‡Ğ½Ğ¾Ñ— Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ¸                â”‚
â”‚ ğŸ”Š TTS: "ĞŸÑ–Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¶ĞµĞ½Ğ¾" / "ĞĞµ Ğ¿Ñ–Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¶ĞµĞ½Ğ¾" (800ms)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ OK?      â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    /            \
                  Ğ¢ĞĞš           ĞĞ†
                   â†“             â†“
         ĞĞ°ÑÑ‚ÑƒĞ¿Ğ½Ğ¸Ğ¹ item    Stage 3-MCP
                           Atlas Adjust
                           (Ğ´Ğ¾ 3 ÑĞ¿Ñ€Ğ¾Ğ±)
                                â†“
                           Retry item
                                â†“
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ĞŸĞĞ’Ğ¢ĞĞ  Ğ¦Ğ˜ĞšĞ›Ğ£ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Stage 8-MCP: Final Summary (System)                         â”‚
â”‚ - Ğ“ĞµĞ½ĞµÑ€ÑƒÑ” Ñ„Ñ–Ğ½Ğ°Ğ»ÑŒĞ½Ğ¸Ğ¹ Ğ·Ğ²Ñ–Ñ‚                                    â”‚
â”‚ - Success rate: X% (completed/failed/skipped)               â”‚
â”‚ ğŸ”Š TTS: "Ğ—Ğ°Ğ²Ğ´Ğ°Ğ½Ğ½Ñ Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ¾ Ğ½Ğ° X%" (2-3s)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Š TTS Ğ¾Ğ·Ğ²ÑƒÑ‡ĞµĞ½Ğ½Ñ Ğ² workflow

### Atlas (Stage 1-MCP)
- **ĞŸĞ¾Ñ‡Ğ°Ñ‚Ğ¾Ğº:** "ĞŸĞ»Ğ°Ğ½ Ğ· 3 Ğ¿ÑƒĞ½ĞºÑ‚Ñ–Ğ², Ğ¿Ğ¾Ñ‡Ğ¸Ğ½Ğ°Ñ Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ½Ñ" (2.5s)
- **Ğ ĞµĞ¶Ğ¸Ğ¼Ğ¸:** standard (1-3) / extended (4-10)
- **Complexity:** 1-10 Ğ²Ğ¸Ğ·Ğ½Ğ°Ñ‡Ğ°Ñ” Ñ€ĞµĞ¶Ğ¸Ğ¼

### Ğ¢ĞµÑ‚ÑĞ½Ğ° (Stages 2.1, 2.2)

#### Stage 2.1 - Plan Tools (150ms - quick)
```javascript
// Ğ“ĞµĞ½ĞµÑ€ÑƒÑ”Ñ‚ÑŒÑÑ Ğ² _generatePlanTTS()
"Ğ’Ñ–Ğ´ĞºÑ€Ğ¸Ğ²Ğ°Ñ..."     // Ğ¯ĞºÑ‰Ğ¾ action.includes('Ğ²Ñ–Ğ´ĞºÑ€')
"Ğ¡Ñ‚Ğ²Ğ¾Ñ€ÑÑ..."       // Ğ¯ĞºÑ‰Ğ¾ action.includes('ÑÑ‚Ğ²Ğ¾Ñ€')
"Ğ—Ğ±ĞµÑ€Ñ–Ğ³Ğ°Ñ..."      // Ğ¯ĞºÑ‰Ğ¾ action.includes('Ğ·Ğ±ĞµÑ€')
"Ğ¨ÑƒĞºĞ°Ñ..."         // Ğ†Ğ½ÑˆÑ– Ğ´Ñ–Ñ—
```

#### Stage 2.2 - Execute Tools (100-800ms)
```javascript
// Ğ“ĞµĞ½ĞµÑ€ÑƒÑ”Ñ‚ÑŒÑÑ Ğ² _generateExecutionTTS()
"Ğ¡Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾"         // ÑÑ‚Ğ²Ğ¾Ñ€* + success
"Ğ’Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ğ¾"         // Ğ²Ñ–Ğ´ĞºÑ€* + success
"Ğ—Ğ±ĞµÑ€ĞµĞ¶ĞµĞ½Ğ¾"        // Ğ·Ğ±ĞµÑ€* + success
"Ğ—Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾"         // Ğ·Ğ½Ğ°Ğ¹Ğ´* + success
"Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾"           // Ğ†Ğ½ÑˆÑ– + success
"Ğ’Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ¾ Ñ‡Ğ°ÑÑ‚ĞºĞ¾Ğ²Ğ¾" // Ğ§Ğ°ÑÑ‚ĞºĞ¾Ğ²Ğ° ÑƒÑĞ¿Ñ–ÑˆĞ½Ñ–ÑÑ‚ÑŒ
```

### Ğ“Ñ€Ñ–ÑˆĞ° (Stage 2.3)
- **Success:** "âœ… ĞŸÑ–Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¶ĞµĞ½Ğ¾" (800ms)
- **Failure:** "âŒ ĞĞµ Ğ¿Ñ–Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¶ĞµĞ½Ğ¾" (800ms)

### System (Stage 8)
- **Final:** "Ğ—Ğ°Ğ²Ğ´Ğ°Ğ½Ğ½Ñ Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ¾ Ğ½Ğ° 100%" (2-3s)
- **Partial:** "Ğ’Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ¾ Ñ‡Ğ°ÑÑ‚ĞºĞ¾Ğ²Ğ¾: 67%" (2-3s)
- **Failed:** "ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ñ‚Ğ¸ Ğ·Ğ°Ğ²Ğ´Ğ°Ğ½Ğ½Ñ" (2s)

---

## ğŸ› Ğ’Ğ¸Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ñ– Ğ¿Ğ¾Ğ¼Ğ¸Ğ»ĞºĞ¸ (13.10.2025 ~23:30)

### 1. âŒ `action: undefined` Ğ² TODO items

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:**
```
[STAGE-1-MCP]      1. undefined
[STAGE-1-MCP]      2. undefined
[STAGE-1-MCP]      3. undefined
```

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:**
LLM ĞĞ• Ğ¾Ñ‚Ñ€Ğ¸Ğ¼ÑƒĞ²Ğ°Ğ² **Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚ Ğ· JSON schema** Ñ– Ğ¿Ñ€Ğ¸ĞºĞ»Ğ°Ğ´Ğ°Ğ¼Ğ¸. Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒĞ²Ğ°Ğ²ÑÑ Ğ¼Ñ–Ğ½Ñ–Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¸Ğ¹:
```javascript
content: 'You are Atlas, a planning AI. Create a TODO list in JSON format.'
```

**Ğ’Ğ¸Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ:**
```javascript
// orchestrator/workflow/mcp-todo-manager.js - createTodo()

// Ğ‘Ğ£Ğ›Ğ (WRONG):
const prompt = this._buildTodoCreationPrompt(request, context);
messages: [
    { role: 'system', content: 'You are Atlas...' }, // ĞœÑ–Ğ½Ñ–Ğ¼Ğ°Ğ»ÑŒĞ½Ğ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚
    { role: 'user', content: prompt }
]

// Ğ¡Ğ¢ĞĞ›Ğ (CORRECT):
const { MCP_PROMPTS } = await import('../../prompts/mcp/index.js');
const todoPrompt = MCP_PROMPTS.ATLAS_TODO_PLANNING;

const userMessage = todoPrompt.userPrompt
    .replace('{{request}}', request)
    .replace('{{context}}', JSON.stringify(context, null, 2));

messages: [
    {
        role: 'system',
        content: todoPrompt.systemPrompt // ĞŸĞĞ’ĞĞ˜Ğ™ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚ Ğ· schema + Ğ¿Ñ€Ğ¸ĞºĞ»Ğ°Ğ´Ğ¸!
    },
    {
        role: 'user',
        content: userMessage
    }
]
```

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:**
âœ… LLM Ñ‚ĞµĞ¿ĞµÑ€ Ğ¾Ñ‚Ñ€Ğ¸Ğ¼ÑƒÑ” **213 Ñ€ÑĞ´ĞºÑ–Ğ² Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚Ñƒ** Ğ·:
- JSON schema ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸ TodoItem
- ĞŸÑ€Ğ°Ğ²Ğ¸Ğ»Ğ°Ğ¼Ğ¸ ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ TODO
- ĞŸÑ€Ğ¸ĞºĞ»Ğ°Ğ´Ğ°Ğ¼Ğ¸ Standard (3 items) Ñ‚Ğ° Extended (6 items) mode
- Ğ§Ñ–Ñ‚ĞºĞ¸Ğ¼Ğ¸ ĞºÑ€Ğ¸Ñ‚ĞµÑ€Ñ–ÑĞ¼Ğ¸ Ğ²Ğ¸Ğ±Ğ¾Ñ€Ñƒ Ñ€ĞµĞ¶Ğ¸Ğ¼Ñƒ

---

### 2. âŒ `workflowStart is not defined`

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:**
```
Backend selection error: workflowStart is not defined
Stage execution failed (stage=1, agent=atlas): content.replace is not a function
```

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:**
Ğ—Ğ¼Ñ–Ğ½Ğ½Ğ° `workflowStart` Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒĞ²Ğ°Ğ»Ğ°ÑÑŒ Ğ² `executeTaskWorkflow()`, Ğ°Ğ»Ğµ ĞĞ• Ğ±ÑƒĞ»Ğ° Ğ²Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ°:
```javascript
async function executeTaskWorkflow(userMessage, session, res, allStages, workflowConfig) {
  let currentStage = session.currentStage || 1;
  // ... later ...
  duration: Date.now() - workflowStart // âŒ workflowStart Ğ½Ğµ Ñ–ÑĞ½ÑƒÑ”!
}
```

**Ğ’Ğ¸Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ:**
```javascript
// orchestrator/workflow/executor-v3.js - executeTaskWorkflow()

async function executeTaskWorkflow(userMessage, session, res, allStages, workflowConfig) {
  const workflowStart = Date.now(); // âœ… FIXED 13.10.2025
  let currentStage = session.currentStage || 1;
  const maxCycles = workflowConfig.maxCycles || 3;
  let cycleCount = 0;
  // ...
}
```

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:**
âœ… Workflow Ñ‚ĞµĞ¿ĞµÑ€ ĞºĞ¾Ñ€ĞµĞºÑ‚Ğ½Ğ¾ Ğ²Ñ–Ğ´ÑÑ‚ĞµĞ¶ÑƒÑ” Ñ‚Ñ€Ğ¸Ğ²Ğ°Ğ»Ñ–ÑÑ‚ÑŒ Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ½Ñ

---

### 3. âŒ `content.replace is not a function`

**ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ°:**
```
Stage execution failed (stage=1, agent=atlas): content.replace is not a function
```

**ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ°:**
`extractModeFromResponse(content)` Ğ¾Ñ‡Ñ–ĞºÑƒĞ²Ğ°Ğ² **ÑÑ‚Ñ€Ñ–Ğ½Ğ³Ñƒ**, Ğ°Ğ»Ğµ Ğ¾Ñ‚Ñ€Ğ¸Ğ¼ÑƒĞ²Ğ°Ğ² **Ğ¾Ğ±'Ñ”ĞºÑ‚**:
```javascript
function extractModeFromResponse(content) {
  const cleanContent = content.replace(/^\[SYSTEM\]\s*/, '').trim(); // âŒ content = {}
}
```

**Ğ’Ğ¸Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ:**
```javascript
// orchestrator/workflow/executor-v3.js - extractModeFromResponse()

function extractModeFromResponse(content) {
  try {
    // âœ… FIXED 13.10.2025 - Handle content as object or string
    let contentStr = content;
    if (typeof content === 'object' && content !== null) {
      contentStr = JSON.stringify(content);
    }
    
    const cleanContent = contentStr.replace(/^\[SYSTEM\]\s*/, '').trim();
    const json = JSON.parse(cleanContent);
    return json.mode === 'chat' ? 'chat' : 'task';
  } catch (error) {
    // Fallback parsing
    const text = (typeof content === 'string' ? content : JSON.stringify(content)).toLowerCase();
    if (text.includes('"mode":"chat"') || text.includes('mode: chat')) {
      return 'chat';
    }
    return 'task'; // Default to task
  }
}
```

**Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:**
âœ… Ğ¤ÑƒĞ½ĞºÑ†Ñ–Ñ Ñ‚ĞµĞ¿ĞµÑ€ Ğ¾Ğ±Ñ€Ğ¾Ğ±Ğ»ÑÑ” **Ğ¾Ğ±Ğ¸Ğ´Ğ²Ğ° Ñ‚Ğ¸Ğ¿Ğ¸** - string Ñ– object

---

## ğŸ“Š ĞÑ‡Ñ–ĞºÑƒĞ²Ğ°Ğ½Ñ– Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¸ Ğ¿Ñ–ÑĞ»Ñ Ğ²Ğ¸Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½ÑŒ

### Ğ”Ğ¾ Ğ²Ğ¸Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ:
```
[TODO] Created standard TODO with 3 items (complexity: 5/10)
[STAGE-1-MCP]      1. undefined  âŒ
[STAGE-1-MCP]      2. undefined  âŒ
[STAGE-1-MCP]      3. undefined  âŒ
Backend selection error: workflowStart is not defined  âŒ
Stage execution failed: content.replace is not a function  âŒ
```

### ĞŸÑ–ÑĞ»Ñ Ğ²Ğ¸Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ:
```
[TODO] Created standard TODO with 3 items (complexity: 5/10)
[STAGE-1-MCP]      1. Ğ’Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ğ¸ ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ñ‡ĞµÑ€ĞµĞ· Spotlight  âœ…
[STAGE-1-MCP]      2. Ğ’Ğ²ĞµÑÑ‚Ğ¸ Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ñƒ Ğ´Ğ»Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñƒ 666 (22Ã—30.27)  âœ…
[STAGE-1-MCP]      3. Ğ—Ñ€Ğ¾Ğ±Ğ¸Ñ‚Ğ¸ ÑĞºÑ€Ñ–Ğ½ÑˆĞ¾Ñ‚ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñƒ Ñ‚Ğ° Ğ·Ğ±ĞµÑ€ĞµĞ³Ñ‚Ğ¸ Ğ½Ğ° Desktop  âœ…
[STAGE-2.1-MCP] ğŸ› ï¸ Planning tools... (Ğ¢ĞµÑ‚ÑĞ½Ğ°)
[STAGE-2.2-MCP] âš™ï¸ Executing tools... (Ğ¢ĞµÑ‚ÑĞ½Ğ°)
[STAGE-2.3-MCP] âœ“ Verification... (Ğ“Ñ€Ñ–ÑˆĞ°)
[STAGE-8-MCP] ğŸ“Š Final summary... (System)
Success rate: 100%  âœ…
```

---

## ğŸ” Ğ¢ĞµÑÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ

### 1. ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ° TODO ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ:
```bash
# Ğ’Ñ–Ğ´Ğ¿Ñ€Ğ°Ğ²Ğ¸Ñ‚Ğ¸ Ğ·Ğ°Ğ¿Ğ¸Ñ‚ Ñ‡ĞµÑ€ĞµĞ· orchestrator
curl -X POST http://localhost:5101/chat/stream \
  -H "Content-Type: application/json" \
  -d '{
    "message": "Ğ’Ñ–Ğ´ĞºÑ€Ğ¸Ğ¹ ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ñ– Ğ¿ĞµÑ€ĞµĞ¼Ğ½Ğ¾Ğ¶ Ñ‚Ğ°Ğ¼ Ğ´Ğ²Ñ– Ñ†Ğ¸Ñ„Ñ€Ğ¸ Ñ‚Ğ°ĞºĞ¸Ğ¼ Ñ‡Ğ¸Ğ½Ğ¾Ğ¼ Ñ‰Ğ¾Ğ± Ğ² Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ– Ğ²Ğ¸Ğ±Ğ¸Ğ»Ğ¾ 666 Ñ– Ğ¿Ğ¾Ñ‚Ñ–Ğ¼ Ğ·Ğ±ĞµÑ€ĞµĞ¶Ğ¸ ÑĞºÑ€Ñ–Ğ½ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñƒ Ğ½Ğ° Ñ€Ğ¾Ğ±Ğ¾Ñ‡Ğ¾Ğ¼Ñƒ ÑÑ‚Ğ¾Ğ»Ñ–",
    "sessionId": "test_todo"
  }'

# ĞÑ‡Ñ–ĞºÑƒĞ²Ğ°Ğ½Ğ¸Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ² Ğ»Ğ¾Ğ³Ğ°Ñ…:
tail -f logs/orchestrator.log | grep -E "TODO|action"
# [TODO] Created standard TODO with 3 items
# [STAGE-1-MCP]      1. Ğ’Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ğ¸ ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€...  âœ…
# [STAGE-1-MCP]      2. Ğ’Ğ²ĞµÑÑ‚Ğ¸ Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ñƒ...  âœ…
# [STAGE-1-MCP]      3. Ğ—Ñ€Ğ¾Ğ±Ğ¸Ñ‚Ğ¸ ÑĞºÑ€Ñ–Ğ½ÑˆĞ¾Ñ‚...  âœ…
```

### 2. ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ° TTS Ğ¾Ğ·Ğ²ÑƒÑ‡ĞµĞ½Ğ½Ñ:
```bash
# ĞœĞ¾Ğ½Ñ–Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ TTS Ğ¿Ğ¾Ğ´Ñ–Ğ¹
tail -f logs/orchestrator.log | grep -E "TTS|speak|phrase"

# ĞÑ‡Ñ–ĞºÑƒĞ²Ğ°Ğ½Ğ¸Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚:
# [TODO] TTS: "ĞŸĞ»Ğ°Ğ½ Ğ· 3 Ğ¿ÑƒĞ½ĞºÑ‚Ñ–Ğ², Ğ¿Ğ¾Ñ‡Ğ¸Ğ½Ğ°Ñ Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ½Ñ" (2.5s)
# [STAGE-2.1] TTS: "Ğ’Ñ–Ğ´ĞºÑ€Ğ¸Ğ²Ğ°Ñ..." (150ms)
# [STAGE-2.2] TTS: "Ğ’Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ğ¾" (800ms)
# [STAGE-2.3] TTS: "ĞŸÑ–Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¶ĞµĞ½Ğ¾" (800ms)
# ... (Ğ´Ğ»Ñ ĞºĞ¾Ğ¶Ğ½Ğ¾Ğ³Ğ¾ item) ...
# [STAGE-8] TTS: "Ğ—Ğ°Ğ²Ğ´Ğ°Ğ½Ğ½Ñ Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ¾ Ğ½Ğ° 100%" (2.5s)
```

### 3. ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€ĞºĞ° workflow Ğ±ĞµĞ· Ğ¿Ğ¾Ğ¼Ğ¸Ğ»Ğ¾Ğº:
```bash
# ĞŸĞµÑ€ĞµĞ²Ñ–Ñ€Ğ¸Ñ‚Ğ¸ Ñ‰Ğ¾ Ğ½ĞµĞ¼Ğ°Ñ” undefined Ñ‚Ğ° errors
tail -100 logs/orchestrator.log | grep -E "undefined|workflowStart|content.replace"
# ĞœĞ°Ñ” Ğ±ÑƒÑ‚Ğ¸ ĞŸĞ£Ğ¡Ğ¢Ğ (no errors)  âœ…
```

---

## ğŸ“‹ ĞšÑ€Ğ¸Ñ‚Ğ¸Ñ‡Ğ½Ñ– Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°

### âœ… TODO Items ÑÑ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ½Ñ:
1. **Ğ—ĞĞ’Ğ–Ğ”Ğ˜** Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒĞ¹Ñ‚Ğµ ĞŸĞĞ’ĞĞ˜Ğ™ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚ Ğ· `MCP_PROMPTS.ATLAS_TODO_PLANNING`
2. **ĞĞ†ĞšĞĞ›Ğ˜** ĞĞ• Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒĞ¹Ñ‚Ğµ Ğ¼Ñ–Ğ½Ñ–Ğ¼Ğ°Ğ»ÑŒĞ½Ñ– system prompts Ğ±ĞµĞ· schema
3. **Complexity** Ğ²Ğ¸Ğ·Ğ½Ğ°Ñ‡Ğ°Ñ” Ñ€ĞµĞ¶Ğ¸Ğ¼: 1-4 â†’ standard, 5-10 â†’ extended
4. **Action** Ğ¿Ğ¾Ñ‡Ğ¸Ğ½Ğ°Ñ”Ñ‚ÑŒÑÑ Ğ· Ğ´Ñ–Ñ”ÑĞ»Ğ¾Ğ²Ğ°: "Ğ’Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ğ¸", "Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸", "Ğ—Ğ±ĞµÑ€ĞµĞ³Ñ‚Ğ¸"
5. **Success criteria** Ñ‡Ñ–Ñ‚ĞºÑ– Ñ‚Ğ° Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€Ğ½Ñ–

### âœ… Workflow execution:
1. **Item-by-item** - ĞĞ• Ğ²ÑÑ– items Ğ¾Ğ´Ğ½Ğ¾Ñ‡Ğ°ÑĞ½Ğ¾
2. **Dependencies** Ğ¢Ğ†Ğ›Ğ¬ĞšĞ˜ backward (item 3 â†’ [1,2], ĞĞ• [4+])
3. **Retry** max 3 ÑĞ¿Ñ€Ğ¾Ğ±Ğ¸ Ğ½Ğ° ĞºĞ¾Ğ¶ĞµĞ½ item
4. **Verification** Ğ“Ñ€Ñ–ÑˆĞ° Ğ¿ĞµÑ€ĞµĞ²Ñ–Ñ€ÑÑ” ĞšĞĞ–Ğ•Ğ item Ğ¾ĞºÑ€ĞµĞ¼Ğ¾

### âœ… TTS ÑĞ¸Ğ½Ñ…Ñ€Ğ¾Ğ½Ñ–Ğ·Ğ°Ñ†Ñ–Ñ:
1. **Quick** (100-200ms) - "Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾", "ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°"
2. **Normal** (500-1000ms) - "Ğ¡Ñ‚Ğ²Ğ¾Ñ€ĞµĞ½Ğ¾ Ñ„Ğ°Ğ¹Ğ»", "Ğ”Ğ°Ğ½Ñ– Ğ·Ñ–Ğ±Ñ€Ğ°Ğ½Ğ¾"
3. **Detailed** (2-3s) - "ĞŸĞ»Ğ°Ğ½ Ğ· 5 Ğ¿ÑƒĞ½ĞºÑ‚Ñ–Ğ², Ğ¿Ğ¾Ñ‡Ğ¸Ğ½Ğ°Ñ Ğ²Ğ¸ĞºĞ¾Ğ½Ğ°Ğ½Ğ½Ñ"
4. **Ğ¢ĞµĞ¼Ğ¿** - ĞºĞ¾Ñ€Ğ¾Ñ‚ĞºÑ– Ñ„Ñ€Ğ°Ğ·Ğ¸ Ğ´Ğ»Ñ ÑˆĞ²Ğ¸Ğ´ĞºĞ¾Ğ³Ğ¾ Ñ†Ğ¸ĞºĞ»Ñƒ

---

## ğŸ“„ Ğ’Ğ¸Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ñ– Ñ„Ğ°Ğ¹Ğ»Ğ¸

1. **orchestrator/workflow/mcp-todo-manager.js**
   - Ğ’Ğ¸Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ `createTodo()` - Ñ‚ĞµĞ¿ĞµÑ€ Ğ²Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ¾Ğ²ÑƒÑ” ĞŸĞĞ’ĞĞ˜Ğ™ Ğ¿Ñ€Ğ¾Ğ¼Ğ¿Ñ‚
   - Lines: ~85-115

2. **orchestrator/workflow/executor-v3.js**
   - Ğ’Ğ¸Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ `executeTaskWorkflow()` - Ğ´Ğ¾Ğ´Ğ°Ğ½Ğ¾ `workflowStart` Ğ²Ğ¸Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ½Ñ
   - Ğ’Ğ¸Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¾ `extractModeFromResponse()` - type-safe Ğ¾Ğ±Ñ€Ğ¾Ğ±ĞºĞ° content
   - Lines: ~902, ~141-158

---

## ğŸ“ Ğ”Ğ¾Ğ´Ğ°Ñ‚ĞºĞ¾Ğ²Ğ° Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ

**Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ñ–Ñ:**
- `docs/MCP_DYNAMIC_TODO_WORKFLOW_SYSTEM.md` - ĞŸĞ¾Ğ²Ğ½Ğ¸Ğ¹ Ğ°Ñ€Ñ…Ñ–Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ğ¸Ğ¹ Ğ¾Ğ¿Ğ¸Ñ
- `docs/MCP_DYNAMIC_TODO_WORKFLOW_SUMMARY.md` - ĞšĞ¾Ñ€Ğ¾Ñ‚ĞºĞ¸Ğ¹ summary
- `prompts/mcp/atlas_todo_planning.js` - ĞŸÑ€Ğ¾Ğ¼Ğ¿Ñ‚ Ğ· JSON schema

**Ğ¢ĞµÑÑ‚ÑƒĞ²Ğ°Ğ½Ğ½Ñ:**
```bash
./test-mcp-workflow.sh  # ĞŸĞ¾Ğ²Ğ½Ğ¸Ğ¹ Ñ‚ĞµÑÑ‚ MCP workflow
```

**Ğ”ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ– Ğ»Ğ¾Ğ³Ğ¸:**
```bash
tail -f logs/orchestrator.log | grep -E "MCP|TODO|Stage"
```

---

**READY FOR TESTING** âœ…
