# –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫ –∑ –≤–µ–±-–ª–æ–≥—ñ–≤
**–î–∞—Ç–∞:** 16.10.2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ

## –ü—Ä–æ–±–ª–µ–º–∏, —è–∫—ñ –±—É–ª–∏ –≤–∏—è–≤–ª–µ–Ω—ñ

### 1. Unknown stream message types
**–ü–æ–º–∏–ª–∫–∞:**
```
[CHAT] Unknown stream message type mode_selected
[CHAT] Unknown stream message type mcp_workflow_error
```

**–ü—Ä–∏—á–∏–Ω–∞:**  
–í—ñ–¥—Å—É—Ç–Ω—ñ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –¥–ª—è –Ω–æ–≤–∏—Ö —Ç–∏–ø—ñ–≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –≤—ñ–¥ orchestrator:
- `mode_selected` - –ø–æ–¥—ñ—è –≤–∏–±–æ—Ä—É —Ä–µ–∂–∏–º—É —á–∞—Ç—É
- `mcp_workflow_error` - –ø–æ–º–∏–ª–∫–∞ MCP workflow

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**  
–î–æ–¥–∞–Ω–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –≤ `chat-manager.js`:

```javascript
// –î–æ–¥–∞–Ω–æ –≤ handleStreamMessage switch
case 'mode_selected':
  this.handleModeSelected(data.data);
  break;
case 'mcp_workflow_error':
  this.handleMCPWorkflowError(data.data);
  break;

// –î–æ–¥–∞–Ω–æ –Ω–æ–≤—ñ –º–µ—Ç–æ–¥–∏
handleModeSelected(data) {
  this.logger.info('üéØ Mode selected', data);
  if (data.mode) {
    this.logger.debug(`Chat mode: ${data.mode}`);
  }
}

handleMCPWorkflowError(data) {
  this.logger.error('‚ùå MCP Workflow error', data.error || data.message);
  const errorMsg = data.error || data.message || '–ù–µ–≤—ñ–¥–æ–º–∞ –ø–æ–º–∏–ª–∫–∞ MCP workflow';
  this.addMessage(`‚ùå MCP: ${errorMsg}`, 'system');
}
```

### 2. WebSocket messages with missing type
**–ü–æ–º–∏–ª–∫–∞:**
```
[ATLAS] WebSocket message with missing or undefined type {status: 'ok', timestamp: '...', received: {...}}
```

**–ü—Ä–∏—á–∏–Ω–∞:**  
–î–µ—è–∫—ñ WebSocket –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–∏—Ö–æ–¥—è—Ç—å –±–µ–∑ –ø–æ–ª—è `type` –∞–±–æ –∑ `type: undefined`.

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**  
–í–∂–µ –±—É–ª–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ –≤ `websocket-client.js`:
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –≤–∞–ª—ñ–¥–Ω–∏–π —Ç–∏–ø –ø–µ—Ä–µ–¥ –æ–±—Ä–æ–±–∫–æ—é
- Debug –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑–∞–º—ñ—Å—Ç—å warning –¥–ª—è —Ç–∞–∫–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- –ü—Ä–æ–ø—É—Å–∫ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –±–µ–∑ —Ç–∏–ø—É –±–µ–∑ –ø–æ–º–∏–ª–æ–∫

```javascript
// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –≤–∞–ª—ñ–¥–Ω–∏–π —Ç–∏–ø
if (!type || type === 'undefined' || type === undefined) {
  this.logger.debug('WebSocket message with missing or undefined type', message);
  return; // –ü—Ä–æ–ø—É—Å–∫–∞—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –±–µ–∑ —Ç–∏–ø—É
}
```

### 3. Microphone device not found warning
**–ü–æ–º–∏–ª–∫–∞:**
```
[MICROPHONE_BUTTON] [WARN] Media support check failed during initialization (will retry on first use)
Data: null
Error: NotFoundError: Requested device not found
```

**–ü—Ä–∏—á–∏–Ω–∞:**  
–ü—Ä–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –º–µ–¥—ñ–∞ API, –∞–ª–µ —Ü–µ –º–æ–∂–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ –ø–æ–º–∏–ª–∫—É —è–∫—â–æ:
- –ú—ñ–∫—Ä–æ—Ñ–æ–Ω –Ω–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–∏–π
- –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –¥–∞–≤ –¥–æ–∑–≤–æ–ª—É
- –ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫—É—î –¥–æ—Å—Ç—É–ø

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**  
–ó–º—ñ–Ω–µ–Ω–æ —Ä—ñ–≤–µ–Ω—å –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑ `warn` –Ω–∞ `info` –≤ `microphone-button-service.js`:

```javascript
// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—ñ –º–µ–¥—ñ–∞ API (non-blocking - —Ç—ñ–ª—å–∫–∏ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è)
try {
  await this.checkMediaSupport();
} catch {
  this.logger.info('Media support check skipped during initialization (will check on first use)');
  // –ù–ï –±–ª–æ–∫—É—î–º–æ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—é - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –≤—ñ–¥–±—É–¥–µ—Ç—å—Å—è –ø—Ä–∏ —Å–ø—Ä–æ–±—ñ –∑–∞–ø–∏—Å—É
}
```

**–û–±“ë—Ä—É–Ω—Ç—É–≤–∞–Ω–Ω—è:**  
–¶–µ –Ω–µ —î –ø–æ–º–∏–ª–∫–æ—é - —Å–∏—Å—Ç–µ–º–∞ –∫–æ—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–æ–±–ª—è—î —Ü—é —Å–∏—Ç—É–∞—Ü—ñ—é —ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å –º—ñ–∫—Ä–æ—Ñ–æ–Ω–∞ –ø—Ä–∏ –ø–µ—Ä—à–æ–º—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ. –¢–æ–º—É –∑–º—ñ–Ω–µ–Ω–æ –Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.

## –§–∞–π–ª–∏, —è–∫—ñ –±—É–ª–∏ –∑–º—ñ–Ω–µ–Ω—ñ

1. **`/web/static/js/modules/chat-manager.js`**
   - –î–æ–¥–∞–Ω–æ –æ–±—Ä–æ–±–Ω–∏–∫ `handleModeSelected()`
   - –î–æ–¥–∞–Ω–æ –æ–±—Ä–æ–±–Ω–∏–∫ `handleMCPWorkflowError()`
   - –î–æ–¥–∞–Ω–æ cases –≤ `handleStreamMessage()` switch

2. **`/web/static/js/voice-control/services/microphone-button-service.js`**
   - –ó–º—ñ–Ω–µ–Ω–æ —Ä—ñ–≤–µ–Ω—å –ª–æ–≥—É–≤–∞–Ω–Ω—è –∑ `warn` –Ω–∞ `info`
   - –í–∏–¥–∞–ª–µ–Ω–æ –Ω–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—É –∑–º—ñ–Ω–Ω—É `mediaError`

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ –í—Å—ñ –ø–æ–º–∏–ª–∫–∏ –∑ –≤–µ–±-–ª–æ–≥—ñ–≤ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ:
- –ù–µ–º–∞—î –±—ñ–ª—å—à–µ "Unknown stream message type"
- WebSocket –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –±–µ–∑ —Ç–∏–ø—É –∫–æ—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–æ–±–ª—è—é—Ç—å—Å—è
- –ü–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ –º—ñ–∫—Ä–æ—Ñ–æ–Ω –∑–∞–º—ñ–Ω–µ–Ω–æ –Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–ü—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É —Å–∏—Å—Ç–µ–º–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏:
1. ‚úÖ –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫ "Unknown stream message type" –≤ –∫–æ–Ω—Å–æ–ª—ñ
2. ‚úÖ –ö–æ—Ä–µ–∫—Ç–Ω–∞ –æ–±—Ä–æ–±–∫–∞ MCP workflow –ø–æ–º–∏–ª–æ–∫
3. ‚úÖ –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å warning –ø—Ä–æ –º—ñ–∫—Ä–æ—Ñ–æ–Ω –ø—Ä–∏ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó
4. ‚úÖ –ù–æ—Ä–º–∞–ª—å–Ω–∞ —Ä–æ–±–æ—Ç–∞ WebSocket –∑'—î–¥–Ω–∞–Ω–Ω—è

## –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø—Ä–∏–º—ñ—Ç–∫–∏

- –í—Å—ñ –∑–º—ñ–Ω–∏ –∑–≤–æ—Ä–æ—Ç–Ω—å–æ —Å—É–º—ñ—Å–Ω—ñ
- –ù–µ –≤–ø–ª–∏–≤–∞—é—Ç—å –Ω–∞ —ñ—Å–Ω—É—é—á—É —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å
- –ü–æ–∫—Ä–∞—â—É—é—Ç—å —è–∫—ñ—Å—Ç—å –ª–æ–≥—É–≤–∞–Ω–Ω—è —Ç–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
