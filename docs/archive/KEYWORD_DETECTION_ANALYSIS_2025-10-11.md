# Keyword Detection Analysis & Fix Plan - 11.10.2025 (—Ä–∞–Ω–Ω—è –Ω—ñ—á ~02:05)

## üîç –ü—Ä–æ–±–ª–µ–º–∞

**–°–∏–º–ø—Ç–æ–º:** Conversation mode –∞–∫—Ç–∏–≤—É—î—Ç—å—Å—è, –∞–ª–µ –ù–ï —Ä–µ–∞–≥—É—î –Ω–∞ —Å–ª–æ–≤–æ "–ê—Ç–ª–∞—Å"

**–õ–æ–≥–∏ –ø–æ–∫–∞–∑—É—é—Ç—å:**
```
‚úÖ [CONVERSATION] üì° Emitting START_KEYWORD_DETECTION event
‚ùå –ù–µ–º–∞—î –ª–æ–≥—ñ–≤ [KEYWORD] üì® Received START_KEYWORD_DETECTION
```

**–í–∏—Å–Ω–æ–≤–æ–∫:** KeywordDetectionService –ù–ï –æ—Ç—Ä–∏–º—É—î –ø–æ–¥—ñ—é –ê–ë–û –ù–ï —Ä–æ–∑–ø—ñ–∑–Ω–∞—î —Å–ª–æ–≤–æ.

---

## üî¨ –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑

### 1. –Ø–∫–∏–º —á–∏–Ω–æ–º –ø—Ä–æ—Å–ª—É—Ö–æ–≤—É—î—Ç—å—Å—è?

**Web Speech API (browser native):**
- KeywordDetectionService –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î `window.SpeechRecognition`
- –¶–µ browser API, –ø—Ä–∞—Ü—é—î –ª–æ–∫–∞–ª—å–Ω–æ
- **–®–≤–∏–¥–∫—ñ—Å—Ç—å:** –î—É–∂–µ —à–≤–∏–¥–∫–∞ (real-time)
- **–¢–æ—á–Ω—ñ—Å—Ç—å:** –ó–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –±—Ä–∞—É–∑–µ—Ä–∞
- **–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞:** –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –≤–∞—Ä—ñ—é—î—Ç—å—Å—è

**Whisper (–æ–∫—Ä–µ–º–∏–π —Å–µ—Ä–≤—ñ—Å):**
- WhisperService –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Whisper.cpp —á–µ—Ä–µ–∑ HTTP
- –ü—Ä–∞—Ü—é—î –Ω–∞ –ø–æ—Ä—Ç—É 3002
- **–®–≤–∏–¥–∫—ñ—Å—Ç—å:** –ü–æ–≤—ñ–ª—å–Ω—ñ—à–∞ (~1-3 —Å–µ–∫—É–Ω–¥–∏ –æ–±—Ä–æ–±–∫–∏)
- **–¢–æ—á–Ω—ñ—Å—Ç—å:** –î—É–∂–µ –≤–∏—Å–æ–∫–∞ (state-of-the-art)
- **–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞:** –í—ñ–¥–º—ñ–Ω–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞

### 2. –ü–æ—Ç–æ—á–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è keywords

**–§–∞–π–ª:** `web/static/js/voice-control/core/config.js`
```javascript
'activation': {
  'keywords': [
    '–∞—Ç–ª–∞—Å',      // ‚ùå –¢—ñ–ª—å–∫–∏ –æ–¥–∏–Ω –≤–∞—Ä—ñ–∞–Ω—Ç
    'atlas'       // ‚ùå –ê–Ω–≥–ª—ñ–π—Å—å–∫–∏–π
  ],
  'confidence': 0.7,
  'language': 'uk-UA'
}
```

**–ü—Ä–æ–±–ª–µ–º–∏:**
1. ‚ùå –¢—ñ–ª—å–∫–∏ 2 –≤–∞—Ä—ñ–∞–Ω—Ç–∏ —Å–ª–æ–≤–∞
2. ‚ùå Web Speech API –º–æ–∂–µ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞—Ç–∏ –ø–æ-—Ä—ñ–∑–Ω–æ–º—É
3. ‚ùå –ù–µ–º–∞—î –≤–∞—Ä—ñ–∞—Ü—ñ–π –Ω–∞–ø–∏—Å–∞–Ω–Ω—è/–≤–∏–º–æ–≤–∏
4. ‚ùå –ù–µ–º–∞—î –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏—Ö –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤

---

## üõ†Ô∏è –†—ñ—à–µ–Ω–Ω—è

### –í–∞—Ä—ñ–∞–Ω—Ç 1: –ü–æ–∫—Ä–∞—â–∏—Ç–∏ Web Speech API (—à–≤–∏–¥—à–µ, –∞–ª–µ –º–µ–Ω—à —Ç–æ—á–Ω–æ)

#### 1.1. –î–æ–¥–∞—Ç–∏ –≤–∞—Ä—ñ–∞—Ü—ñ—ó –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤

**–§–∞–π–ª:** `config/global-config.js`
```javascript
voice: {
  activation: {
    keywords: [
      // –û—Å–Ω–æ–≤–Ω—ñ –≤–∞—Ä—ñ–∞–Ω—Ç–∏
      '–∞—Ç–ª–∞—Å',
      'atlas',
      
      // –í–∞—Ä—ñ–∞—Ü—ñ—ó –≤–∏–º–æ–≤–∏
      '–∞—Ç–ª–∞–∑',
      '–∞—Ç–ª—É—Å',
      '–∞—Ç–ª–µ—Å',
      
      // –ó –Ω–∞–≥–æ–ª–æ—Å–∞–º–∏
      '–∞ÃÅ—Ç–ª–∞—Å',
      '–∞—Ç–ª–∞ÃÅ—Å',
      
      // –ß–∞—Å—Ç–∏–Ω–∏ —ñ–º–µ–Ω—ñ
      '–æ–ª–µ–≥ –º–∏–∫–æ–ª–∞–π–æ–≤–∏—á',
      '–æ–ª–µ–∂–µ –º–∏–∫–æ–ª–∞–π–æ–≤–∏—á—É',
      
      // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∏
      '–µ–π –∞—Ç–ª–∞—Å',
      '–≥–µ–π –∞—Ç–ª–∞—Å',
      '—Å–ª—É—Ö–∞–π',
      '—Å–ª—É—Ö–∞–π –∞—Ç–ª–∞—Å'
    ],
    confidence: 0.6  // –ó–Ω–∏–∂–µ–Ω–æ –¥–ª—è –∫—Ä–∞—â–æ–≥–æ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è
  }
}
```

#### 1.2. –ü–æ–∫—Ä–∞—â–∏—Ç–∏ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –≤ containsActivationKeyword

**–§–∞–π–ª:** `web/static/js/voice-control/utils/voice-utils.js`
```javascript
export function containsActivationKeyword(text, keywords = VOICE_CONFIG.activation.keywords) {
  if (!text) return false;

  const normalized = text.toLowerCase().trim();
  
  // –¢–æ—á–Ω–µ —Å–ø—ñ–≤–ø–∞–¥—ñ–Ω–Ω—è
  for (const keyword of keywords) {
    if (normalized.includes(keyword.toLowerCase())) {
      return true;
    }
  }
  
  // Fuzzy matching –¥–ª—è –≤–∞—Ä—ñ–∞—Ü—ñ–π
  const fuzzyVariations = [
    '–∞—Ç–ª–∞—Å', '–∞—Ç–ª–∞–∑', '–∞—Ç–ª—É—Å', '–∞—Ç–ª–µ—Å',
    'atlas', 'atlus', 'atlass'
  ];
  
  for (const variation of fuzzyVariations) {
    if (normalized.includes(variation)) {
      return true;
    }
  }
  
  return false;
}
```

### –í–∞—Ä—ñ–∞–Ω—Ç 2: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Whisper –¥–ª—è keyword detection (–ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ, –∞–ª–µ —Ç–æ—á–Ω—ñ—à–µ)

#### 2.1. –°—Ç–≤–æ—Ä–∏—Ç–∏ WhisperKeywordDetectionService

**–Ü–¥–µ—è:** –ó–∞–º—ñ—Å—Ç—å Web Speech API –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Whisper –¥–ª—è –¥–µ—Ç–µ–∫—Ü—ñ—ó –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤.

**–ü–µ—Ä–µ–≤–∞–≥–∏:**
- ‚úÖ –ù–∞–±–∞–≥–∞—Ç–æ —Ç–æ—á–Ω—ñ—à–µ —Ä–æ–∑–ø—ñ–∑–Ω–∞—î —É–∫—Ä–∞—ó–Ω—Å—å–∫—É
- ‚úÖ –ö—Ä–∞—â–µ —Ä–æ–∑–ø—ñ–∑–Ω–∞—î –≤–∞—Ä—ñ–∞—Ü—ñ—ó
- ‚úÖ –ü—Ä–∞—Ü—é—î –∑ —Ä—ñ–∑–Ω–∏–º–∏ –∞–∫—Ü–µ–Ω—Ç–∞–º–∏

**–ù–µ–¥–æ–ª—ñ–∫–∏:**
- ‚ùå –ü–æ–≤—ñ–ª—å–Ω—ñ—à–µ (~1-3 —Å–µ–∫ –∑–∞—Ç—Ä–∏–º–∫–∞)
- ‚ùå –ü–æ—Ç—Ä–µ–±—É—î —Å–µ—Ä–≤–µ—Ä–Ω–æ—ó –æ–±—Ä–æ–±–∫–∏
- ‚ùå –ë—ñ–ª—å—à–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

#### 2.2. –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

```javascript
// Conversation Mode –∞–∫—Ç–∏–≤—É—î—Ç—å—Å—è
‚Üí startListeningForKeyword()
‚Üí MicrophoneButtonService.startContinuousRecording()
‚Üí –ö–æ–∂–Ω—ñ 2-3 —Å–µ–∫—É–Ω–¥–∏: –≤—ñ–¥–ø—Ä–∞–≤–∫–∞ –∞—É–¥—ñ–æ –≤ Whisper
‚Üí Whisper —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±—É—î
‚Üí –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞
‚Üí –Ø–∫—â–æ –∑–Ω–∞–π–¥–µ–Ω–æ "–∞—Ç–ª–∞—Å" ‚Üí emit KEYWORD_DETECTED
```

### –í–∞—Ä—ñ–∞–Ω—Ç 3: –ì—ñ–±—Ä–∏–¥–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ (–Ω–∞–π–∫—Ä–∞—â–µ —Å–ø—ñ–≤–≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è)

#### 3.1. Web Speech –¥–ª—è –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó –¥–µ—Ç–µ–∫—Ü—ñ—ó
- –®–≤–∏–¥–∫–æ —Ä–µ–∞–≥—É—î –Ω–∞ –º–æ–∂–ª–∏–≤—ñ –∫–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞
- –ù–∏–∑—å–∫–∏–π –ø–æ—Ä—ñ–≥ confidence (0.4-0.5)

#### 3.2. Whisper –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
- –Ø–∫—â–æ Web Speech –¥–µ—Ç–µ–∫—Ç—É—î ‚Üí –∫–æ—Ä–æ—Ç–∫–∏–π –∑–∞–ø–∏—Å Whisper
- Whisper –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î —á–∏ —Å–ø—Ä–∞–≤–¥—ñ "–∞—Ç–ª–∞—Å"
- –¢—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è ‚Üí KEYWORD_DETECTED

---

## üìä –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | Web Speech (–ø–æ–∫—Ä–∞—â–µ–Ω–∏–π) | Whisper | –ì—ñ–±—Ä–∏–¥ |
| -------------- | ----------------------- | ------- | ------ |
| –®–≤–∏–¥–∫—ñ—Å—Ç—å      | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê                   | ‚≠ê‚≠ê      | ‚≠ê‚≠ê‚≠ê‚≠ê   |
| –¢–æ—á–Ω—ñ—Å—Ç—å       | ‚≠ê‚≠ê‚≠ê                     | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê   | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê  |
| –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞     | ‚≠ê‚≠ê‚≠ê                     | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê   | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê  |
| –ù–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è   | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê                   | ‚≠ê‚≠ê      | ‚≠ê‚≠ê‚≠ê    |
| –°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å     | ‚≠ê‚≠ê                      | ‚≠ê‚≠ê‚≠ê‚≠ê    | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê  |

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–∏–π –ø–ª–∞–Ω

### Phase 1: –®–≤–∏–¥–∫–µ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è (–ó–ê–†–ê–ó)

1. ‚úÖ –î–æ–¥–∞—Ç–∏ –≤–∞—Ä—ñ–∞—Ü—ñ—ó –∫–ª—é—á–æ–≤–∏—Ö —Å–ª—ñ–≤ –≤ config
2. ‚úÖ –ü–æ–∫—Ä–∞—â–∏—Ç–∏ containsActivationKeyword –∑ fuzzy matching
3. ‚úÖ –ó–Ω–∏–∑–∏—Ç–∏ confidence threshold –¥–æ 0.5
4. ‚úÖ –î–æ–¥–∞—Ç–∏ –ª–æ–≥—É–≤–∞–Ω–Ω—è —Ä–æ–∑–ø—ñ–∑–Ω–∞–Ω–∏—Ö —Ñ—Ä–∞–∑

**–ß–∞—Å:** 15-20 —Ö–≤–∏–ª–∏–Ω  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Web Speech –∫—Ä–∞—â–µ —Ä–æ–∑–ø—ñ–∑–Ω–∞—î "–∞—Ç–ª–∞—Å"

### Phase 2: –ì—ñ–±—Ä–∏–¥–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ (–ü–Ü–ó–ù–Ü–®–ï)

1. ‚è≥ –î–æ–¥–∞—Ç–∏ Whisper fallback –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è
2. ‚è≥ –û–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ —Ä–æ–∑–º—ñ—Ä –∞—É–¥—ñ–æ chunks
3. ‚è≥ –î–æ–¥–∞—Ç–∏ –∫–µ—à—É–≤–∞–Ω–Ω—è —Ä–æ–∑–ø—ñ–∑–Ω–∞–Ω–∏—Ö —Ñ—Ä–∞–∑

**–ß–∞—Å:** 1-2 –≥–æ–¥–∏–Ω–∏  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ú–∞–π–∂–µ 100% —Ç–æ—á–Ω—ñ—Å—Ç—å

### Phase 3: Whisper-only (–û–ü–¶–Ü–û–ù–ê–õ–¨–ù–û)

1. ‚è≥ –ü–æ–≤–Ω—ñ—Å—Ç—é –∑–∞–º—ñ–Ω–∏—Ç–∏ Web Speech –Ω–∞ Whisper
2. ‚è≥ –û–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ streaming audio
3. ‚è≥ –î–æ–¥–∞—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–∏–π –∫–µ—à –º–æ–¥–µ–ª—ñ

**–ß–∞—Å:** 3-4 –≥–æ–¥–∏–Ω–∏  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–∞–π–≤–∏—â–∞ —Ç–æ—á–Ω—ñ—Å—Ç—å, –∞–ª–µ –ø–æ–≤—ñ–ª—å–Ω—ñ—à–µ

---

## üöÄ –Ü–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü—ñ—è Phase 1

### –ö—Ä–æ–∫ 1: –û–Ω–æ–≤–∏—Ç–∏ config

**–§–∞–π–ª:** `config/global-config.js`
```javascript
export const CONFIG = {
  voice: {
    activation: {
      keywords: [
        '–∞—Ç–ª–∞—Å', 'atlas',
        '–∞—Ç–ª–∞–∑', '–∞—Ç–ª—É—Å', '–∞—Ç–ª–µ—Å',
        '–∞ÃÅ—Ç–ª–∞—Å', '–∞—Ç–ª–∞ÃÅ—Å',
        '–µ–π –∞—Ç–ª–∞—Å', '–≥–µ–π –∞—Ç–ª–∞—Å',
        '—Å–ª—É—Ö–∞–π', '—Å–ª—É—Ö–∞–π –∞—Ç–ª–∞—Å',
        '–æ–ª–µ–≥ –º–∏–∫–æ–ª–∞–π–æ–≤–∏—á'
      ],
      confidence: 0.5  // –ó–Ω–∏–∂–µ–Ω–æ –∑ 0.7
    }
  }
};
```

### –ö—Ä–æ–∫ 2: –ü–æ–∫—Ä–∞—â–∏—Ç–∏ voice-utils.js

**–î–æ–¥–∞—Ç–∏ fuzzy matching —Ç–∞ –ª–æ–≥—É–≤–∞–Ω–Ω—è:**
```javascript
export function containsActivationKeyword(text, keywords) {
  console.log('[KEYWORD] üîç Checking text:', text);
  
  const normalized = text.toLowerCase().trim();
  
  // –¢–æ—á–Ω–µ —Å–ø—ñ–≤–ø–∞–¥—ñ–Ω–Ω—è
  for (const keyword of keywords) {
    if (normalized.includes(keyword.toLowerCase())) {
      console.log('[KEYWORD] ‚úÖ Exact match:', keyword);
      return true;
    }
  }
  
  // Fuzzy –¥–ª—è –≤–∞—Ä—ñ–∞—Ü—ñ–π "–∞—Ç–ª–∞—Å"
  const atlasVariations = ['–∞—Ç–ª–∞—Å', '–∞—Ç–ª–∞–∑', '–∞—Ç–ª—É—Å', '–∞—Ç–ª–µ—Å', 'atlas'];
  for (const variant of atlasVariations) {
    if (normalized.includes(variant)) {
      console.log('[KEYWORD] ‚úÖ Fuzzy match:', variant);
      return true;
    }
  }
  
  console.log('[KEYWORD] ‚ùå No keyword match in:', text);
  return false;
}
```

### –ö—Ä–æ–∫ 3: –î–æ–¥–∞—Ç–∏ –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤ recognition handler

**–§–∞–π–ª:** `keyword-detection-service.js`
```javascript
handleRecognitionResult(event) {
  for (let i = event.resultIndex; i < event.results.length; i++) {
    const result = event.results[i];
    const transcript = result[0].transcript.trim();
    const confidence = result[0].confidence || 1.0;

    // ‚úÖ –î–û–î–ê–¢–ò –¶–ï
    console.log('[KEYWORD] üé§ Web Speech recognized:', {
      text: transcript,
      confidence,
      isFinal: result.isFinal
    });

    if (result.isFinal) {
      this.processFinalResult(transcript, confidence);
    }
  }
}
```

---

## ‚úÖ –û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**–ü—ñ—Å–ª—è Phase 1:**
```
[KEYWORD] üé§ Web Speech recognized: {text: "–∞—Ç–ª–∞—Å", confidence: 0.8, isFinal: true}
[KEYWORD] üîç Checking text: "–∞—Ç–ª–∞—Å"
[KEYWORD] ‚úÖ Exact match: –∞—Ç–ª–∞—Å
[KEYWORD] üéØ Keyword detected!
[KEYWORD] üó£Ô∏è Generated response: "–°–ª—É—Ö–∞—é"
[CONVERSATION] üì® Received KEYWORD_DETECTED event
[CONVERSATION] ‚úÖ Keyword matched! Activating...
```

---

**Status:** Phase 1 ready for implementation  
**Estimated time:** 15-20 minutes  
**Next:** Implement config changes and fuzzy matching

**Datetime:** 11.10.2025, —Ä–∞–Ω–Ω—è –Ω—ñ—á ~02:05
